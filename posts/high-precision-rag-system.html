<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>æ„å»ºåŸºäºERNIEä¸Milvusçš„å¤šæ–‡æ¡£é«˜ç²¾åº¦åˆ†æä¸é—®ç­”ç³»ç»Ÿ | é£æ¡¨å¼€æºç¤¾åŒºåšå®¢</title>
    <meta name="description" content="Wonderful stories from PaddlePaddle contributors">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.BId5x853.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Cce2DscU.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.DU_EuCD6.js">
    <link rel="modulepreload" href="/assets/chunks/framework.BRsttz9t.js">
    <link rel="modulepreload" href="/assets/posts_high-precision-rag-system.md.CfUn4ZYF.lean.js">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    <link rel="mask-icon" href="/icons/mask-icon.svg" color="#ffffff">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7XR50K1YRK"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7XR50K1YRK");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="manifest" href="/manifest.webmanifest">
  </head>
  <body>
    <div id="app"><div class="antialiased dark:bg-neutral-900 min-h-screen"><div class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><nav class="flex justify-between items-center py-10 font-bold"><a class="text-xl" href="/" aria-label="é£æ¡¨å¼€æºç¤¾åŒºåšå®¢"><img class="inline-block mr-2" style="width:120px;" alt="logo" src="/logo.png"><span class="hidden md:inline dark:text-white">é£æ¡¨å¼€æºç¤¾åŒºåšå®¢</span></a><div class="text-sm text-gray-500 dark:text-white leading-5"><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://github.com/PFCCLab/blog" target="_blank" rel="noopener"><span class="hidden sm:inline">GitHub </span>Source</a><span class="mr-2 ml-2">Â·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="/about.html" rel="noopener">About</a><span class="mr-2 ml-2">Â·</span><a class="hover:text-gray-700 dark:hover:text-gray-200" href="https://github.com/PFCCLab" target="_blank" rel="noopener">PFCCLab â†’</a></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0"><article class="xl:divide-y xl:divide-gray-200 dark:xl:divide-slate-200/5"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500 dark:text-gray-300"><time datetime="2025-12-01T12:00:00.000Z">2025å¹´12æœˆ1æ—¥</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 dark:text-white tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">æ„å»ºåŸºäºERNIEä¸Milvusçš„å¤šæ–‡æ¡£é«˜ç²¾åº¦åˆ†æä¸é—®ç­”ç³»ç»Ÿ</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 dark:divide-slate-200/5 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200 dark:xl:border-slate-200/5"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-col pl-10 gap-y-5 md:grid md:grid-cols-2 md:gap-x-8 md:gap-y-6 md:pl-0 lg:grid-cols-3 xl:block xl:space-y-8"><!--[--><li class="flex items-center space-x-2"><img src="https://github.com/LiaoYFBH.png" alt="author image" class="w-10 h-10 rounded-full"><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-white">å»–é›¨è²</dd><dt class="sr-only">GitHub</dt><dd><a href="https://github.com/LiaoYFBH" target="_blank" rel="noopnener noreferrer" class="link">@LiaoYFBH</a></dd></dl></li><!--]--></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-slate-200/5 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose dark:prose-invert max-w-none pt-10 pb-8"><div><p>åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„åº”ç”¨è½åœ°ä¸­ï¼ŒRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯è§£å†³æ¨¡å‹å¹»è§‰å’ŒçŸ¥è¯†æ—¶æ•ˆæ€§çš„å…³é”®æŠ€æœ¯ã€‚æœ¬åšå®¢å°†å¯¹æœ¬å¤šæ–‡æ¡£é«˜ç²¾åº¦æ™ºèƒ½åˆ†æä¸é—®ç­”ç³»ç»Ÿçš„å…³é”®æŠ€æœ¯è¿›è¡Œè¯´æ˜ä»‹ç»ã€‚è¯¥ç³»ç»Ÿé›†æˆäº† <strong>åœ¨çº¿ OCR è§£æ</strong>ã€<strong>Milvus æ··åˆæ£€ç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰</strong> ä»¥åŠ <strong>å¤šç»´åº¦çš„é‡æ’åºï¼ˆRerankerï¼‰</strong> ç­–ç•¥ï¼Œæ—¨åœ¨æå‡ä½èµ„æºç¯å¢ƒä¸‹çš„æ£€ç´¢å‡†ç¡®ç‡ï¼Œä»¥å®ç°é«˜ç²¾åº¦å¤šæ–‡æ¡£åˆ†æä¸é—®ç­”ã€‚</p><h2 id="_1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ" tabindex="-1">1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ <a class="header-anchor" href="#_1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ" aria-label="Permalink to &quot;1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ&quot;">â€‹</a></h2><p>æœ¬é¡¹ç›®çš„ç³»ç»Ÿä¸»è¦ç”±å››ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š</p><ol><li><strong>æ•°æ®æå–å±‚</strong>ï¼šä½¿ç”¨åœ¨çº¿ OCR API è¿›è¡Œé«˜ç²¾åº¦çš„æ–‡æ¡£å¸ƒå±€åˆ†æï¼ˆLayout Parsingï¼‰ã€‚</li><li><strong>å­˜å‚¨å±‚</strong>ï¼šåˆ©ç”¨ Milvus å‘é‡æ•°æ®åº“å­˜å‚¨ Dense Embeddingï¼ŒåŒæ—¶ç»´æŠ¤å€’æ’ç´¢å¼•ä»¥æ”¯æŒå…³é”®è¯æ£€ç´¢ã€‚</li><li><strong>æ£€ç´¢ä¸é—®ç­”å±‚</strong>ï¼šå®ç°å‘é‡æ£€ç´¢ä¸å…³é”®è¯æ£€ç´¢çš„åŠ æƒèåˆï¼ˆRRFï¼‰ï¼Œé›†æˆ ERNIE å¤§æ¨¡å‹ API æ¥å£ç”Ÿæˆå›ç­”ã€‚</li><li><strong>åº”ç”¨å±‚</strong>ï¼šåŸºäº Gradio æ„å»ºäº¤äº’ç•Œé¢ã€‚</li></ol><div style="display:flex;justify-content:center;"><img src="/assets/flow.BJoDpzLA.jpg" alt="Fig 2" style="width:80%;"></div><h3 id="ğŸ”—-é¡¹ç›®èµ„æº" tabindex="-1">ğŸ”— é¡¹ç›®èµ„æº <a class="header-anchor" href="#ğŸ”—-é¡¹ç›®èµ„æº" aria-label="Permalink to &quot;ğŸ”— é¡¹ç›®èµ„æº&quot;">â€‹</a></h3><ul><li><p>ğŸ™ GitHub ä»£ç ä»“åº“ï¼š<a href="https://github.com/LiaoYFBH/Paddle-ERNIE-RAG" target="_blank" rel="noreferrer">ç‚¹å‡»è®¿é—®</a></p></li><li><p>ğŸš€ æ˜Ÿæ²³ç¤¾åŒºåœ¨çº¿åº”ç”¨ï¼š<a href="https://aistudio.baidu.com/application/detail/107183" target="_blank" rel="noreferrer">ç«‹å³ä½“éªŒ</a></p></li><li><p>ğŸ““ æ˜Ÿæ²³ç¤¾åŒº Notebookï¼š<a href="https://aistudio.baidu.com/project/edit/9812333" target="_blank" rel="noreferrer">åœ¨çº¿è¿è¡Œ</a></p></li></ul><h2 id="_2-å…³é”®æŠ€æœ¯å®ç°" tabindex="-1">2. å…³é”®æŠ€æœ¯å®ç° <a class="header-anchor" href="#_2-å…³é”®æŠ€æœ¯å®ç°" aria-label="Permalink to &quot;2. å…³é”®æŠ€æœ¯å®ç°&quot;">â€‹</a></h2><h3 id="_2-1-pp-structurev3-æ–‡æ¡£è§£æ" tabindex="-1">2.1 PP-StructureV3 æ–‡æ¡£è§£æ <a class="header-anchor" href="#_2-1-pp-structurev3-æ–‡æ¡£è§£æ" aria-label="Permalink to &quot;2.1 PP-StructureV3 æ–‡æ¡£è§£æ&quot;">â€‹</a></h3><p>é’ˆå¯¹ç§‘ç ”è®ºæ–‡ä¸­å¸¸è§çš„åŒæ æ’ç‰ˆã€å…¬å¼æ··æ’åŠå›¾è¡¨åµŒå…¥é—®é¢˜ï¼Œä¼ ç»Ÿçš„ PyPDF2 ç­‰çº¯æ–‡æœ¬æå–å·¥å…·å¾€å¾€åŠ›ä¸ä»å¿ƒï¼ˆå®¹æ˜“å¯¼è‡´æ®µè½ä¹±åºã€è¡¨æ ¼å´©åï¼‰ã€‚</p><p>ä¸ºæ­¤ï¼Œæœ¬é¡¹ç›®åœ¨ backend.py ä¸­å°è£…äº† OnlinePDFParser ç±»ï¼Œç›´æ¥é›†æˆ PP-StructureV3 åœ¨çº¿ API è¿›è¡Œé«˜ç²¾åº¦çš„æ–‡æ¡£å¸ƒå±€åˆ†æï¼ˆLayout Parsingï¼‰ã€‚</p><p>è¯¥æ–¹æ¡ˆå…·å¤‡ä¸‰å¤§æ ¸å¿ƒä¼˜åŠ¿ï¼š</p><ul><li><p><strong>ç»“æ„åŒ–è¾“å‡º</strong>ï¼šç›´æ¥è¿”å› Markdown æ ¼å¼ï¼ˆè‡ªåŠ¨è¯†åˆ«æ ‡é¢˜å±‚çº§ã€æ®µè½è¾¹ç•Œï¼‰ã€‚</p></li><li><p><strong>å›¾è¡¨æå–</strong>ï¼šåœ¨è§£ææ–‡æœ¬çš„åŒæ—¶ï¼Œè‡ªåŠ¨æå–æ–‡æ¡£ä¸­çš„å›¾ç‰‡å¹¶è½¬å­˜ï¼Œä¸ºåç»­çš„â€œå¤šæ¨¡æ€é—®ç­”â€æä¾›ç´ æã€‚</p></li><li><p><strong>ä¸Šä¸‹æ–‡ä¿ç•™</strong>ï¼šåŸºäºæ»‘åŠ¨çª—å£è¿›è¡Œåˆ‡åˆ†ï¼Œé˜²æ­¢å…³é”®ä¿¡æ¯åœ¨åˆ‡ç‰‡è¾¹ç•Œä¸¢å¤±ã€‚</p></li></ul><h4 id="_2-1-1-æ ¸å¿ƒè§£æé€»è¾‘" tabindex="-1">2.1.1 æ ¸å¿ƒè§£æé€»è¾‘ <a class="header-anchor" href="#_2-1-1-æ ¸å¿ƒè§£æé€»è¾‘" aria-label="Permalink to &quot;2.1.1 æ ¸å¿ƒè§£æé€»è¾‘&quot;">â€‹</a></h4><p>åœ¨ backend.py ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº† API è¯·æ±‚ï¼Œå°† PDF æ–‡ä»¶æµå‘é€è‡³æœåŠ¡ç«¯ï¼Œå¹¶è§£æè¿”å›çš„ layoutParsingResultsï¼Œæå–å‡ºæ¸…æ´—åçš„ Markdown æ–‡æœ¬å’Œå›¾ç‰‡èµ„æºã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py (OnlinePDFParser ç±»æ ¸å¿ƒé€»è¾‘æ‘˜è¦)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> predict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, file_path):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. æ–‡ä»¶è½¬ Base64</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file_path, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rb&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        file_data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base64.b64encode(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.read()).decode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ascii&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. æ„é€ è¯·æ±‚ Payload</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    payload </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: file_data,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;fileType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PDF ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;useChartRecognition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ¹æ®éœ€æ±‚é…ç½®</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;useDocOrientationClassify&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. å‘é€è¯·æ±‚è·å– Layout Parsing ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    response </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requests.post(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.api_url, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">payload, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">headers)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    res_json </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.json()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. æå– Markdown æ–‡æœ¬ä¸å›¾ç‰‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    parsing_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> res_json.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;result&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {}).get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;layoutParsingResults&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    mock_outputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> parsing_results:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        md_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;markdown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {}).get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        images </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;markdown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {}).get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;images&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {})</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ... (åç»­å›¾ç‰‡ä¸‹è½½ä¸æ–‡æœ¬æ¸…æ´—é€»è¾‘)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mock_outputs.append(MockResult(md_text, images))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mock_outputs, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Success&quot;</span></span></code></pre></div><h4 id="_2-1-2-æ»‘åŠ¨çª—å£æ–‡æœ¬åˆ†å—" tabindex="-1">2.1.2 æ»‘åŠ¨çª—å£æ–‡æœ¬åˆ†å— <a class="header-anchor" href="#_2-1-2-æ»‘åŠ¨çª—å£æ–‡æœ¬åˆ†å—" aria-label="Permalink to &quot;2.1.2 æ»‘åŠ¨çª—å£æ–‡æœ¬åˆ†å—&quot;">â€‹</a></h4><p>æ‹¿åˆ°ç»“æ„åŒ–çš„ Markdown æ–‡æœ¬åï¼Œä¸ºäº†é¿å…è¯­ä¹‰è¢«ç”Ÿç¡¬åˆ‡æ–­ï¼ˆä¾‹å¦‚ä¸€å¥è¯è·¨äº†ä¸¤ä¸ª chunkï¼‰ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¸¦æœ‰ overlapï¼ˆé‡å åŒºï¼‰çš„æ»‘åŠ¨çª—å£åˆ†å—ç­–ç•¥ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> split_text_into_chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, chunk_size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, overlap: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">list</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;åŸºäºæ»‘åŠ¨çª—å£çš„æ–‡æœ¬åˆ†å—ï¼Œä¿ç•™ overlap é•¿åº¦çš„é‡å ä¸Šä¸‹æ–‡&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lines </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [line.strip() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> text.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line.strip()]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    chunks </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    current_chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    current_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lines:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        while</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_size:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # å¤„ç†è¶…é•¿å•è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            part </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line[:chunk_size]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            line </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> line[chunk_size:]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            current_chunk.append(part)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # ... (åˆ‡åˆ†é€»è¾‘) ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        current_chunk.append(line)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        current_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(line)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # å½“ç´¯ç§¯é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼Œç”Ÿæˆä¸€ä¸ª chunk</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk_size:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            chunks.append(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(current_chunk))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # å›é€€ï¼šä¿ç•™æœ€å overlap é•¿åº¦çš„æ–‡æœ¬ä½œä¸ºä¸‹ä¸€ä¸ª chunk çš„å¼€å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            overlap_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_chunk[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">overlap:] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            current_chunk </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [overlap_text] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> overlap_text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            current_length </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(overlap_text)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_chunk:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        chunks.append(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.join(current_chunk).strip())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunks</span></span></code></pre></div><h3 id="_2-2-milvus-å‘é‡åº“ä¸æ··åˆæ£€ç´¢ç­–ç•¥" tabindex="-1">2.2 Milvus å‘é‡åº“ä¸æ··åˆæ£€ç´¢ç­–ç•¥ <a class="header-anchor" href="#_2-2-milvus-å‘é‡åº“ä¸æ··åˆæ£€ç´¢ç­–ç•¥" aria-label="Permalink to &quot;2.2 Milvus å‘é‡åº“ä¸æ··åˆæ£€ç´¢ç­–ç•¥&quot;">â€‹</a></h3><h4 id="_2-2-1-çŸ¥è¯†åº“å‘½åçš„å·¥ç¨‹åŒ–å¤„ç†" tabindex="-1">2.2.1 çŸ¥è¯†åº“å‘½åçš„å·¥ç¨‹åŒ–å¤„ç† <a class="header-anchor" href="#_2-2-1-çŸ¥è¯†åº“å‘½åçš„å·¥ç¨‹åŒ–å¤„ç†" aria-label="Permalink to &quot;2.2.1 çŸ¥è¯†åº“å‘½åçš„å·¥ç¨‹åŒ–å¤„ç†&quot;">â€‹</a></h4><p>åœ¨å®é™…éƒ¨ç½²ä¸­ï¼ŒMilvus ç­‰å‘é‡æ•°æ®åº“å¯¹é›†åˆåç§°ï¼ˆCollection Nameï¼‰é€šå¸¸æœ‰ä¸¥æ ¼çš„å‘½åé™åˆ¶ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨åç«¯ä»£ç ä¸­å®ç°äº†ä¸€å¥—é€æ˜çš„ç¼–è§£ç æœºåˆ¶ã€‚</p><ol><li><strong>ç¼–ç  (Encode)</strong>ï¼šå½“ç”¨æˆ·åˆ›å»ºå¦‚â€œç‰©ç†è®ºæ–‡â€çš„åº“æ—¶ï¼Œç³»ç»Ÿå°†å…¶ UTF-8 å­—èŠ‚è½¬æ¢ä¸º Hex å­—ç¬¦ä¸²ï¼Œå¹¶æ·»åŠ  <code>kb_</code> å‰ç¼€ã€‚</li><li><strong>è§£ç  (Decode)</strong>ï¼šåœ¨å‰ç«¯å±•ç¤ºæ—¶ï¼Œè‡ªåŠ¨å°† Hex å­—ç¬¦ä¸²åè§£ä¸ºåŸå§‹ä¸­æ–‡ã€‚</li></ol><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binascii</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encode_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ui_name):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æŠŠä¸­æ–‡åç§°è½¬ä¸º Milvus åˆæ³•çš„ Hex å­—ç¬¦ä¸²&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ui_name: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # å¦‚æœæ˜¯çº¯è‹±æ–‡/æ•°å­—/ä¸‹åˆ’çº¿ï¼Œç›´æ¥è¿”å›</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> re.match(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">^[a-zA-Z_][a-zA-Z0-9_]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ui_name):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ui_name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Hex ç¼–ç å¹¶åŠ å‰ç¼€ kb_</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    hex_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binascii.hexlify(ui_name.encode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).decode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kb_</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">hex_str</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> decode_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(real_name):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æŠŠ Hex å­—ç¬¦ä¸²è½¬å›ä¸­æ–‡&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> real_name.startswith(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;kb_&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            hex_str </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> real_name[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binascii.unhexlify(hex_str).decode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        except</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> real_name</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> real_name</span></span></code></pre></div><h4 id="_2-2-2-å‘é‡åŒ–å…¥åº“ä¸å…ƒæ•°æ®ç»‘å®š" tabindex="-1">2.2.2 å‘é‡åŒ–å…¥åº“ä¸å…ƒæ•°æ®ç»‘å®š <a class="header-anchor" href="#_2-2-2-å‘é‡åŒ–å…¥åº“ä¸å…ƒæ•°æ®ç»‘å®š" aria-label="Permalink to &quot;2.2.2 å‘é‡åŒ–å…¥åº“ä¸å…ƒæ•°æ®ç»‘å®š&quot;">â€‹</a></h4><p>åœ¨ OCR è§£æå¹¶å°†é•¿æ–‡æœ¬åˆ‡åˆ†ä¸º Chunks åï¼Œç³»ç»Ÿå¹¶éç®€å•åœ°å°†æ–‡æœ¬å­˜å…¥æ•°æ®åº“ï¼Œè€Œæ˜¯æ‰§è¡Œäº† <strong>â€œå‘é‡åŒ– + å…ƒæ•°æ®ç»‘å®šâ€</strong> çš„å…³é”®æ­¥éª¤ã€‚</p><p>ä¸ºäº†æ”¯æŒåç»­çš„ç²¾ç¡®æº¯æºï¼ˆCitationï¼‰å’Œå¤šæ¨¡æ€é—®ç­”ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡ Milvus Schema æ—¶ï¼Œé™¤äº†å­˜å‚¨ 384 ç»´çš„ Dense Vector å¤–ï¼Œè¿˜å¼ºåˆ¶ç»‘å®šäº† filenameï¼ˆæ–‡ä»¶åï¼‰ã€pageï¼ˆé¡µç ï¼‰å’Œ chunk_idï¼ˆåˆ‡ç‰‡ IDï¼‰ç­‰æ ‡é‡å­—æ®µã€‚</p><p>è¿™ä¸€è¿‡ç¨‹åœ¨ vector_store.py ä¸­é€šè¿‡ insert_documents æ–¹æ³•å®ç°ï¼Œé‡‡ç”¨æ‰¹é‡ Embedding ç­–ç•¥ä»¥å‡å°‘ç½‘ç»œå¼€é”€ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vector_store.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> insert_documents</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, documents):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;æ‰¹é‡å‘é‡åŒ–å¹¶å†™å…¥ Milvus&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> documents: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. æå–çº¯æ–‡æœ¬åˆ—è¡¨ï¼Œæ‰¹é‡è¯·æ±‚ Embedding æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    texts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> documents]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    embeddings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.get_embeddings(texts)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. æ•°æ®æ¸…æ´—ï¼šè¿‡æ»¤æ‰ Embedding å¤±è´¥çš„åæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    valid_docs, valid_vectors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [], []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i, emb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(embeddings):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> emb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(emb) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 384</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç¡®ä¿å‘é‡ç»´åº¦æ­£ç¡®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            valid_docs.append(documents[i])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            valid_vectors.append(emb)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. ç»„è£…åˆ—å¼æ•°æ® (Columnar Format)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Milvus insert æ¥å£è¦æ±‚å„å­—æ®µæ•°æ®ä»¥åˆ—è¡¨å½¢å¼ä¼ å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;filename&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid_docs],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scalar: æ–‡ä»¶å</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;page&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid_docs],      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scalar: é¡µç  (ç”¨äºæº¯æº)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid_docs],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scalar: åˆ‡ç‰‡ID</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        [doc[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> valid_docs],   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Scalar: åŸå§‹å†…å®¹ (ç”¨äºå…³é”®è¯æ£€ç´¢)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        valid_vectors                             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Vector: è¯­ä¹‰å‘é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. æ‰§è¡Œæ’å…¥ä¸æŒä¹…åŒ–</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection.insert(data)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.collection.flush()</span></span></code></pre></div><h4 id="_2-2-3-æ··åˆæ£€ç´¢ç­–ç•¥" tabindex="-1">2.2.3 æ··åˆæ£€ç´¢ç­–ç•¥ <a class="header-anchor" href="#_2-2-3-æ··åˆæ£€ç´¢ç­–ç•¥" aria-label="Permalink to &quot;2.2.3 æ··åˆæ£€ç´¢ç­–ç•¥&quot;">â€‹</a></h4><p>æ£€ç´¢å‰ï¼Œç³»ç»Ÿé¦–å…ˆåˆ©ç”¨ LLM ç”Ÿæˆçš„é—®é¢˜çš„åŒè¯­ç¿»è¯‘ï¼Œé¿å…ä¸­æ–‡é—®é¢˜è¯¢é—®è‹±æ–‡æ–‡æ¡£ï¼Œä½¿å¾—å…³é”®è¯ä¸åŒ¹é…ï¼Œä»¥æœ€å¤§åŒ–è¯­ä¹‰è¦†ç›–ã€‚éšåå¹¶è¡Œæ‰§è¡Œä¸¤è·¯æ£€ç´¢ï¼š</p><ol><li><strong>Dense (å‘é‡æ£€ç´¢)</strong>ï¼šæ•æ‰è¯­ä¹‰ç›¸ä¼¼åº¦ï¼ˆä¾‹å¦‚â€œç®€è°æŒ¯å­â€ä¸â€œå¼¹ç°§æŒ¯å­â€çš„è¯­ä¹‰å…³è”ï¼‰ã€‚</li><li><strong>Sparse (å…³é”®è¯æ£€ç´¢)</strong>ï¼šå¼¥è¡¥å‘é‡æ¨¡å‹å¯¹ä¸“æœ‰åè¯æˆ–ç²¾ç¡®æ•°å­—åŒ¹é…çš„ä¸è¶³ï¼ˆä¾‹å¦‚ç²¾ç¡®åŒ¹é…å…¬å¼ä¸­çš„å˜é‡åï¼‰ã€‚</li></ol><p>å‘é‡æ£€ç´¢å®¹æ˜“å› è¯­ä¹‰æ³›åŒ–è€Œå¬å›é”™è¯¯æ¦‚å¿µï¼ˆå¦‚â€œå¼¹ç°§æŒ¯å­â€ä¸â€œç®€è°æŒ¯å­â€ï¼‰ï¼Œè€Œå…³é”®è¯æ£€ç´¢èƒ½ç¡®ä¿ä¸“æœ‰åè¯çš„ç²¾ç¡®å‘½ä¸­ï¼Œä»è€Œå¤§å¹…æå‡å‡†ç¡®ç‡ã€‚</p><p>ç„¶åæ‰§è¡Œï¼š</p><ul><li><strong>RRF (å€’æ’èåˆ)</strong>ï¼šç³»ç»Ÿå†…éƒ¨ä½¿ç”¨å€’æ’ç§©èåˆç®—æ³• (Reciprocal Rank Fusion) å°†ä¸¤è·¯ç»“æœåˆå¹¶ï¼Œç¡®ä¿å¤šæ ·æ€§ã€‚</li></ul><div style="display:flex;justify-content:center;"><img src="/assets/RRF_flow.C9n3UDdf.jpg" alt="Fig 2" style="width:50%;"></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># vector_store.py ä¸­çš„æ£€ç´¢é€»è¾‘æ‘˜è¦</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> search</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, top_k: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">**</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">kwargs):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   &#39;&#39;&#39;å‘é‡æ£€ç´¢(Dense+Keyword)+RRF èåˆ&#39;&#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 1. å‘é‡æ£€ç´¢ (Dense)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   dense_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   query_vector </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.embedding_client.get_embedding(query) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... (Milvus search code) ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. å…³é”®è¯æ£€ç´¢ (Keyword)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # é€šè¿‡ jieba åˆ†è¯åæ„å»º like &quot;%keyword%&quot; æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    keyword_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._keyword_search(query, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">top_k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">expr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expr)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. RRF èåˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rank_dict </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> apply_rrf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(results_list, k</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank, item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> enumerate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(results_list):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            doc_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">or</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;chunk_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> doc_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">not</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank_dict:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                rank_dict[doc_id] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: item, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # RRF æ ¸å¿ƒå…¬å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            rank_dict[doc_id][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;score&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apply_rrf(dense_results, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apply_rrf(keyword_results, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. æ’åºè¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sorted_docs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sorted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rank_dict.values(), </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=lambda</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x: x[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">reverse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [item[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sorted_docs[:top_k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]]</span></span></code></pre></div><h3 id="_2-3-ç»¼åˆé‡æ’åºç®—æ³•" tabindex="-1">2.3 ç»¼åˆé‡æ’åºç®—æ³• <a class="header-anchor" href="#_2-3-ç»¼åˆé‡æ’åºç®—æ³•" aria-label="Permalink to &quot;2.3 ç»¼åˆé‡æ’åºç®—æ³•&quot;">â€‹</a></h3><p>æ£€ç´¢å›æ¥çš„ç‰‡æ®µï¼ˆChunksï¼‰éœ€è¦è¿›ä¸€æ­¥ç²¾æ’ã€‚åœ¨ <code>reranker_v2.py</code> ä¸­ï¼Œè®¾è®¡äº†ä¸€å¥—ç»¼åˆæ‰“åˆ†ç®—æ³•ã€‚ è¯„åˆ†ç»´åº¦åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æ¨¡ç³ŠåŒ¹é…ï¼ˆFuzzy Scoreï¼‰</strong>ï¼šä½¿ç”¨ <code>fuzzywuzzy</code> è®¡ç®— Query ä¸ Content çš„å­—é¢é‡åˆåº¦ã€‚</p></li><li><p><strong>å…³é”®è¯è¦†ç›–ç‡ï¼ˆKeyword Coverageï¼‰</strong>ï¼šè®¡ç®— Query ä¸­çš„æ ¸å¿ƒè¯åœ¨æ–‡æ¡£ç‰‡æ®µä¸­çš„å‡ºç°æ¯”ä¾‹ã€‚</p></li><li><p><strong>è¯­ä¹‰ç›¸ä¼¼åº¦</strong>ï¼šæ¥è‡ª Milvus çš„åŸå§‹å‘é‡è·ç¦»ã€‚</p></li><li><p><strong>é•¿åº¦æƒ©ç½šä¸ä½ç½®åç½®</strong>ï¼šå¯¹è¿‡çŸ­çš„ç‰‡æ®µè¿›è¡Œæƒ©ç½šï¼Œå¯¹ Milvus å¬å›çš„æ’åé å‰çš„ç‰‡æ®µç»™äºˆä½ç½®å¥–åŠ±ã€‚</p></li><li><p><strong>ä¸“æœ‰åè¯</strong>ï¼š</p><ul><li><p><strong>è‹±æ–‡ï¼ˆçœ‹â€œå¤§å°å†™â€ç‰¹å¾ï¼‰ï¼š</strong> ä½¿ç”¨æ­£åˆ™ <code>\b[A-Z][a-z]+\b|[A-Z]{2,}</code>ï¼Œä¸“é—¨åŒ¹é…<strong>é¦–å­—æ¯å¤§å†™</strong>çš„å•è¯ï¼ˆå¦‚ &quot;Milvus&quot;ï¼‰æˆ–<strong>å…¨å¤§å†™</strong>çš„ç¼©å†™ï¼ˆå¦‚ &quot;RAG&quot;ï¼‰ï¼Œå› ä¸ºåœ¨è‹±æ–‡ä¸­è¿™äº›é€šå¸¸ä»£è¡¨ä¸“æœ‰åè¯ã€‚</p></li><li><p><strong>ä¸­æ–‡ï¼ˆçœ‹â€œè¿ç»­æ€§â€ç‰¹å¾ï¼‰ï¼š</strong> ç”±äºä¸­æ–‡æ²¡æœ‰å¤§å°å†™ï¼Œç­–ç•¥å˜æˆäº† <strong>â€œåˆ‡åˆ†+é•¿åº¦â€</strong>ï¼šä½¿ç”¨éä¸­æ–‡å­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦åˆ‡æ–­å¥å­ï¼Œä¿ç•™æ‰€æœ‰è¿ç»­å‡ºç° 2 ä¸ªåŠä»¥ä¸Šçš„æ±‰å­—ç‰‡æ®µï¼ˆå¦‚â€œç®€è°æŒ¯å­â€ï¼‰ï¼Œå°†å…¶è§†ä¸ºæ½œåœ¨å®ä½“ã€‚</p></li></ul></li></ol><p>å…·ä½“çš„åˆ†æ•°å æ¯”è§ä¸‹å›¾ï¼š</p><div style="display:flex;justify-content:center;"><img src="/assets/pp-rule-rk.B8yRS1ph.jpg" alt="Fig 2" style="width:80%;"></div><p>è¿™ç§åŸºäºè§„åˆ™ä¸è¯­ä¹‰ç»“åˆçš„é‡æ’åºç­–ç•¥ï¼Œåœ¨æ— è®­ç»ƒæ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¯”çº¯é»‘ç›’æ¨¡å‹æ›´å…·å¯è§£é‡Šæ€§ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># reranker_v2.py</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _calculate_composite_score</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, chunk: Dict[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Any]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;content&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 1. å­—é¢é‡åˆåº¦ (FuzzyWuzzy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fuzzy_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fuzz.partial_ratio(query, content)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 2. å…³é”®è¯è¦†ç›–ç‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    query_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._extract_keywords(query)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._extract_keywords(content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    keyword_coverage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_keywords) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(query_keywords)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> query_keywords </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 3. å‘é‡è¯­ä¹‰åˆ† (å½’ä¸€åŒ–)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    milvus_distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;semantic_score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    milvus_similarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> milvus_distance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 4. é•¿åº¦æƒ©ç½š (åå¥½ 200-600 å­—çš„æ®µè½)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        length_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # ... (æƒ©ç½šé€»è¾‘)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        length_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(content_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # åŠ æƒæ±‚å’Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    base_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        fuzzy_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.25</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        keyword_coverage </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.25</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        milvus_similarity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.35</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        length_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.15</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä½ç½®æƒé‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    position_bonus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;milvus_rank&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rank </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chunk[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;milvus_rank&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        position_bonus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rank)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ä¸“æœ‰åè¯é¢å¤–åŠ åˆ† (Bonus)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    proper_noun_bonus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._check_proper_nouns(query, content) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> base_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> proper_noun_bonus</span></span></code></pre></div><h3 id="_2-4-api-é€Ÿç‡é™åˆ¶ä¸è‡ªé€‚åº”ä¿æŠ¤" tabindex="-1">2.4 API é€Ÿç‡é™åˆ¶ä¸è‡ªé€‚åº”ä¿æŠ¤ <a class="header-anchor" href="#_2-4-api-é€Ÿç‡é™åˆ¶ä¸è‡ªé€‚åº”ä¿æŠ¤" aria-label="Permalink to &quot;2.4 API é€Ÿç‡é™åˆ¶ä¸è‡ªé€‚åº”ä¿æŠ¤&quot;">â€‹</a></h3><p>åœ¨è°ƒç”¨ LLM æˆ– Embedding æœåŠ¡æ—¶ï¼Œå¶å°”ä¼šé‡åˆ° <code>429 Too Many Requests</code>ã€‚æœ¬é¡¹ç›®åœ¨ <code>ernie_client.py</code> ä¸­å®ç°äº†è‡ªé€‚åº”é™é€Ÿæœºåˆ¶ï¼š</p><div class="language-Python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># é‡åˆ°é™æµæ—¶çš„å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> is_rate_limit:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._adaptive_slow_down() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ°¸ä¹…å¢åŠ è¯·æ±‚é—´éš”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wait_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> **</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> attempt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> random.uniform(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æŒ‡æ•°é€€é¿</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    time.sleep(wait_time)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> _adaptive_slow_down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;è§¦å‘è‡ªé€‚åº”é™çº§ï¼šé‡åˆ°é™æµæ—¶ï¼Œæ°¸ä¹…å¢åŠ å…¨å±€è¯·æ±‚é—´éš”&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.current_delay </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.current_delay </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    logger.warning(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ğŸ“‰ è§¦å‘é€Ÿç‡é™åˆ¶(429)ï¼Œç³»ç»Ÿè‡ªåŠ¨é™é€Ÿ: æ–°é—´éš” </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.current_delay</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.2f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>è¿™ä¿è¯äº†ç³»ç»Ÿåœ¨å¤§æ‰¹é‡æ–‡æ¡£å…¥åº“æ—¶çš„ç¨³å®šæ€§ã€‚</p><h3 id="_2-5-å¤šæ¨¡æ€é—®ç­”" tabindex="-1">2.5 å¤šæ¨¡æ€é—®ç­” <a class="header-anchor" href="#_2-5-å¤šæ¨¡æ€é—®ç­”" aria-label="Permalink to &quot;2.5 å¤šæ¨¡æ€é—®ç­”&quot;">â€‹</a></h3><p>é’ˆå¯¹ç§‘ç ”æ–‡æ¡£ä¸­åŒ…å«å¤§é‡å…³é”®å›¾è¡¨ï¼ˆå¦‚å®éªŒæ•°æ®ã€æ¨¡å‹æ¶æ„ï¼‰çš„ç‰¹ç‚¹ï¼Œæœ¬ç³»ç»Ÿå®ç°äº†â€œå›¾è¡¨é”å®šâ€é—®ç­”åŠŸèƒ½ã€‚æ ¸å¿ƒæŠ€æœ¯å®ç°åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªç»´åº¦ï¼š</p><ol><li><p><strong>ä¸Šä¸‹æ–‡å¢å¼º Prompt</strong> åç«¯åœ¨æ„å»ºè¯·æ±‚æ—¶ï¼Œä¸ä»…å‘é€å›¾ç‰‡æœ¬èº«ï¼Œè¿˜æ£€ç´¢è¯¥å›¾ç‰‡æ‰€åœ¨é¡µé¢çš„ OCR æ–‡æœ¬ä½œä¸ºèƒŒæ™¯ä¿¡æ¯ï¼ˆContextï¼‰ã€‚Prompt ç»“æ„åŠ¨æ€æ‹¼è£…äº†â€œå›¾ç‰‡å…ƒæ•°æ® + èƒŒæ™¯æ–‡æœ¬ + ç”¨æˆ·é—®é¢˜â€ï¼Œæœ‰æ•ˆæå‡äº†æ¨¡å‹å¯¹å›¾è¡¨ç»†èŠ‚ä¸ä¸Šä¸‹æ–‡å…³è”çš„ç†è§£èƒ½åŠ›ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py - å¤šæ¨¡æ€é—®ç­”æ ¸å¿ƒé€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. æ£€ç´¢å½“å‰é¡µé¢çš„ OCR æ–‡æœ¬ä½œä¸ºèƒŒæ™¯ (Context)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ç³»ç»Ÿæ ¹æ®æ–‡ä»¶åå’Œé¡µç ï¼Œä» Milvus ä¸­æ‹‰å–è¯¥å›¾æ‰€åœ¨çš„å®Œæ•´é¡µé¢æ–‡æœ¬</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># page_num æ¥è‡ªå‰ç«¯å›¾ç‰‡æ–‡ä»¶åçš„è§£æ (e.g., &quot;p3_figure.jpg&quot; -&gt; Page 3)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page_text_context </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> milvus_store.get_page_content(doc_name, page_num)[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. åŠ¨æ€æ‹¼è£… Context-Enhanced Prompt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…³é”®ç‚¹ï¼šå°†&quot;è§†è§‰ä¿¡æ¯&quot;ä¸&quot;æ–‡æœ¬èƒŒæ™¯&quot;å¼ºåˆ¶å¯¹é½ï¼Œé˜²æ­¢æ¨¡å‹çœ‹å›¾è¯´è¯äº§ç”Ÿå¹»è§‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">final_prompt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ã€ä»»åŠ¡ã€‘ç»“åˆå›¾ç‰‡å’ŒèƒŒæ™¯ä¿¡æ¯å›ç­”é—®é¢˜ã€‚</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ã€å›¾ç‰‡å…ƒæ•°æ®ã€‘æ¥æºï¼š</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> (P</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page_num</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ã€èƒŒæ™¯æ–‡æœ¬ã€‘</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">page_text_context</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ... (æ­¤å¤„çœç•¥é•¿æ–‡æœ¬)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ã€ç”¨æˆ·é—®é¢˜ã€‘</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user_question</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. å‘é€å¤šæ¨¡æ€è¯·æ±‚ (Vision API)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åº•å±‚ä¼šå°†å›¾ç‰‡è½¬ä¸º Base64ï¼Œä¸ final_prompt ä¸€èµ·å‘ç»™ ERNIE-VL æ¨¡å‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ernie_client.chat_with_image(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">final_prompt, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">image_path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">img_path)</span></span></code></pre></div></li><li><p><strong>Vision æ¥å£å°è£…</strong> åº•å±‚å®¢æˆ·ç«¯ï¼ˆ<code>ernie_client.py</code>ï¼‰å®ç°äº† OpenAI å…¼å®¹çš„è§†è§‰åè®®ã€‚ç³»ç»Ÿè‡ªåŠ¨è¯»å–æœ¬åœ°å›¾ç‰‡å¹¶è½¬æ¢ä¸º Base64 ç¼–ç ï¼Œé€šè¿‡ <code>image_url</code> æ ¼å¼æ„å»ºå¤šæ¨¡æ€æ¶ˆæ¯ä½“ï¼Œå®ç°äº†å›¾åƒæ•°æ®ä¸æ–‡æœ¬æŒ‡ä»¤çš„è”åˆæ¨ç†ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ernie_client.py</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> chat_with_image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, query: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, image_path: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   base64_image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._encode_image(image_path)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # æ„é€  Vision æ¶ˆæ¯æ ¼å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   messages </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: query},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                  &quot;image_url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        &quot;url&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;data:image/jpeg;base64,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base64_image</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">               }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   ]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.chat(messages)</span></span></code></pre></div></li><li><p><strong>é™çº§ç­–ç•¥</strong> ä¸ºä¿éšœç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ï¼Œ<code>backend.py</code> ä¸­è®¾è®¡äº†è‡ªåŠ¨å›é€€æœºåˆ¶ã€‚è‹¥å¤šæ¨¡æ€æ¥å£è°ƒç”¨å¼‚å¸¸ï¼ˆå¦‚æ¨¡å‹ä¸æ”¯æŒæˆ–ç½‘ç»œé”™è¯¯ï¼‰ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ•è·å¼‚å¸¸å¹¶æ— ç¼åˆ‡æ¢è‡³æ ‡å‡†æ–‡æœ¬ RAG é€šé“ï¼Œåˆ©ç”¨ OCR æ–‡æœ¬ç»§ç»­å›ç­”ï¼Œç¡®ä¿ç”¨æˆ·å¯¹è¯æµç¨‹ä¸ä¸­æ–­ã€‚</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py ä¸­çš„é™çº§é€»è¾‘</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   answer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ernie.chat_with_image(final_prompt, img_path)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # ...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">except</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Exception</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;âš ï¸ æ¨¡å‹ä¸æ”¯æŒå›¾ç‰‡ï¼Œå‡†å¤‡åˆ‡æ¢è‡³æ–‡æœ¬æ¨¡å¼ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # é™çº§ï¼šä½¿ç”¨æå–å‡ºçš„æ–‡æœ¬ä½œä¸º Context ç»§ç»­é—®ç­”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   answer, metric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ask_question_logic(final_prompt, collection_name)</span></span></code></pre></div></li></ol><h2 id="_3-ç•Œé¢äº¤äº’ä¸æ•ˆæœ" tabindex="-1">3. ç•Œé¢äº¤äº’ä¸æ•ˆæœ <a class="header-anchor" href="#_3-ç•Œé¢äº¤äº’ä¸æ•ˆæœ" aria-label="Permalink to &quot;3. ç•Œé¢äº¤äº’ä¸æ•ˆæœ&quot;">â€‹</a></h2><h3 id="_3-1-æ·±åº¦-css-å®šåˆ¶" tabindex="-1">3.1 æ·±åº¦ CSS å®šåˆ¶ <a class="header-anchor" href="#_3-1-æ·±åº¦-css-å®šåˆ¶" aria-label="Permalink to &quot;3.1 æ·±åº¦ CSS å®šåˆ¶&quot;">â€‹</a></h3><p>å‰ç«¯åŸºäº Gradio æ­å»ºï¼ˆ<code>main.py</code>ï¼‰ï¼Œé‡‡ç”¨è‡ªå®šä¹‰ CSS (<code>modern_css</code>) æ­å»ºäº†ç¾è§‚çš„ UI ç•Œé¢ã€‚é‡ç‚¹æ”¹è¿›äº†è¾“å…¥åŒºåŸŸçš„è§†è§‰å±‚çº§ï¼šå°†é»˜è®¤çš„ç°è‰²èƒŒæ™¯æ”¹ä¸ºç™½åº•åœ†è§’å¡ç‰‡ï¼Œå¹¶ä¸ºå‘é€æŒ‰é’®æ·»åŠ äº†æ¸å˜è‰²ä¸æ‚¬æµ®é˜´å½±ï¼Œä½¿å…¶åœ¨è§†è§‰ä¸Šæ›´åŠ ç°ä»£ä¸èšç„¦ã€‚</p><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* main.py - modern_css ç‰‡æ®µ */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* å¼ºåˆ¶è¾“å…¥æ¡†ç™½åº•åœ†è§’ï¼Œæ¨¡æ‹Ÿç°ä»£ Chat APP */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.custom-textbox</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;"> textarea</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   background-color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">#ffffff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   border</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> solid</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> #e5e7eb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   border-radius</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   box-shadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 12</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rgba</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.05</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">14</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* æ¸å˜è‰²å‘é€æŒ‰é’® */</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.send-btn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">linear-gradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">135</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">deg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">#6366f1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">#4f46e5</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">%</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">white</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   box-shadow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> rgba</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">99</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">102</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">241</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!important</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-2-latex-å…¬å¼æ¸²æŸ“" tabindex="-1">3.2 LaTeX å…¬å¼æ¸²æŸ“ <a class="header-anchor" href="#_3-2-latex-å…¬å¼æ¸²æŸ“" aria-label="Permalink to &quot;3.2 LaTeX å…¬å¼æ¸²æŸ“&quot;">â€‹</a></h3><p>ä¸ºäº†ä¿è¯å…¬å¼åœ¨ UI ç•Œé¢ä¸Šèƒ½æ­£å¸¸æ¸²æŸ“å‡ºæ¥ï¼Œé¦–å…ˆå®šä¹‰ä¸€å¥—å®Œæ•´çš„ LaTeX è¯†åˆ«è§„åˆ™ï¼Œæ¶µç›–è¡Œå†…ä¸è¡Œé—´å…¬å¼.è¿™å¥—é…ç½®è¢«åŒæ—¶é…ç½®åˆ°å¯¹è¯æ¡†ï¼ˆChatbotï¼‰å’Œæ‘˜è¦åŒºï¼ˆMarkdownï¼‰ï¼Œç¡®ä¿æ— è®ºæ˜¯æ¨¡å‹çš„å›ç­”è¿˜æ˜¯æ–‡æ¡£çš„æ‘˜è¦ï¼Œå…¬å¼éƒ½èƒ½è¢«æ¸²æŸ“ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># main.py é…ç½® LaTeX è§„åˆ™</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">latex_config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;left&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;right&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¯†åˆ«è¡Œé—´å…¬å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;left&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;right&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># è¯†åˆ«è¡Œå†…å…¬å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;left&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;right&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ‡å‡† LaTeX è¡Œå†…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;left&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;right&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;display&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># æ ‡å‡† LaTeX è¡Œé—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><p>éšåï¼Œåœ¨å®ä¾‹åŒ–ç»„ä»¶æ—¶å°†æ­¤é…ç½®æ³¨å…¥ï¼š</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨ Chatbot ä¸­å¯ç”¨ LaTeX</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">chatbot </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gr.Chatbot(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    label</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Conversation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... å…¶ä»–å‚æ•° ...</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    latex_delimiters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">latex_config  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># å…³é”®é…ç½®ï¼šå¯ç”¨å…¬å¼æ¸²æŸ“</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># åœ¨æ‘˜è¦æ˜¾ç¤ºåŒºå¯ç”¨ LaTeX</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">doc_summary </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> gr.Markdown(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;*æš‚æ— æ‘˜è¦*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    latex_delimiters</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">latex_config</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_3-3-å¯è§£é‡Šæ€§è®¾è®¡" tabindex="-1">3.3 å¯è§£é‡Šæ€§è®¾è®¡ <a class="header-anchor" href="#_3-3-å¯è§£é‡Šæ€§è®¾è®¡" aria-label="Permalink to &quot;3.3 å¯è§£é‡Šæ€§è®¾è®¡&quot;">â€‹</a></h3><p>åœ¨å®é™…ä½“éªŒä¸­ï¼Œä¸ºäº†æ‰“ç ´ RAG ç³»ç»Ÿçš„â€œé»‘ç›’â€å±æ€§ï¼Œæœ¬åº”ç”¨åœ¨ç•Œé¢ä¸­è®¾è®¡äº†ä¸¤ä¸ªç»´åº¦çš„è¯„ä»·æŒ‡æ ‡ï¼Œåˆ†åˆ«å¯¹åº”å¾®è§‚ä¸å®è§‚è§†è§’ï¼š</p><ul><li><strong>ç›¸å…³æ€§ (Relevance)</strong>ï¼šå‡ºç°åœ¨èŠå¤©æ¡†çš„ã€å‚è€ƒæ¥æºã€‘åˆ—è¡¨ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ª<strong>å¾®è§‚æŒ‡æ ‡</strong>ï¼Œå®ƒç›´æ¥å±•ç¤ºäº† <code>Reranker</code> ç»™æ¯ä¸€ä¸ªå…·ä½“æ–‡æ¡£åˆ‡ç‰‡æ‰“å‡ºçš„ <code>composite_score</code>ï¼ˆåŸºäºå‘é‡+å…³é”®è¯+è§„åˆ™çš„ç»¼åˆå¾—åˆ†ï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ç”¨æˆ·ï¼š<em>â€œä¸ºä»€ä¹ˆç³»ç»Ÿå¼•ç”¨äº†ç¬¬ 3 é¡µè¿™æ®µè¯ï¼Œè€Œä¸æ˜¯ç¬¬ 5 é¡µé‚£æ®µï¼Ÿâ€</em></li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py - æ„å»ºå‚è€ƒæ¥æºåˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ğŸ“š **å‚è€ƒæ¥æº:**</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> final:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ... (å»é‡é€»è¾‘) ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # ç›´æ¥ Reranker è®¡ç®—å‡ºçš„å•ç‰‡å¾—åˆ†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sources </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;- </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [ç›¸å…³æ€§:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">c.get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;composite_score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.0f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><ul><li><strong>ç½®ä¿¡åº¦ (Confidence)</strong>ï¼šå±•ç¤ºåœ¨ã€åˆ†æè¯¦æƒ…ã€‘é¢æ¿ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ª<strong>å®è§‚æŒ‡æ ‡</strong>ï¼Œç³»ç»Ÿæå– <strong>Top-1 åˆ‡ç‰‡</strong>çš„å¾—åˆ†å¹¶è¿›è¡Œå½’ä¸€åŒ–ï¼ˆCapped at 100%ï¼‰ä½œä¸ºæœ¬æ¬¡é—®ç­”çš„æ•´ä½“è¯„åˆ†ã€‚å®ƒçš„ä½œç”¨æ˜¯é¢„è­¦ï¼š<em>â€œç³»ç»Ÿå¯¹è‡ªå·±ç”Ÿæˆçš„ç­”æ¡ˆæœ‰å¤šå¤§æŠŠæ¡ï¼Ÿâ€</em> å¦‚æœç½®ä¿¡åº¦ä½äº 60%ï¼Œå³ä¾¿æ¨¡å‹ç”Ÿæˆçš„æ–‡å­—å†é€šé¡ºï¼Œç”¨æˆ·ä¹Ÿåº”è­¦æƒ•å¯èƒ½å­˜åœ¨çš„â€œå¹»è§‰â€é£é™©ã€‚</li></ul><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># backend.py - è®¡ç®—æ•´ä½“ç½®ä¿¡åº¦</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. è·å–é‡æ’åºåçš„ Top-1 ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">final </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> processed[:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">top_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> final[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].get(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;composite_score&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> final </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. å½’ä¸€åŒ–å¤„ç† (å°é¡¶ 100%)ï¼Œä½œä¸ºæœ¬æ¬¡é—®ç­”çš„&quot;ç½®ä¿¡åº¦&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">metric </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, top_score)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:.1f</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%&quot;</span></span></code></pre></div><p>å®ç°çš„ UI ç•Œé¢æ•ˆæœå¦‚ä¸‹ï¼Œåœ¨å›ç­”ä¸­æ˜¾ç¤ºäº†ç›¸åº”æ¥æºå‘é‡çš„é¡µæ•°å’Œç›¸å…³æ€§ï¼š</p><p><img src="/assets/sys-UI-1-1.D8XSIVeG.jpg" alt="Fig 4ï¼šæ‘˜è¦å’Œå›¾è¡¨"></p><p><img src="/assets/sys-UI-1-2.B7P-Q1BV.jpg" alt="Fig 5ï¼šé€‰æ‹©å›¾è¡¨é—®ç­”"></p><p><img src="/assets/sys-UI-1-3.wUed7i06.jpg" alt="Fig 6ï¼šå…¨éƒ¨æ–‡æ¡£æ£€ç´¢"></p><p><img src="/assets/sys-UI-2.CL5-eggy.jpg" alt="Fig 7ï¼šçŸ¥è¯†åº“ç®¡ç†"></p><p><img src="/assets/sys-UI-3.s2HBdx1A.jpg" alt="Fig 8ï¼šç³»ç»Ÿé…ç½®"></p><h2 id="_4-æ€»ç»“" tabindex="-1">4. æ€»ç»“ <a class="header-anchor" href="#_4-æ€»ç»“" aria-label="Permalink to &quot;4. æ€»ç»“&quot;">â€‹</a></h2><h3 id="_4-1-åŠŸèƒ½äº®ç‚¹" tabindex="-1">4.1 åŠŸèƒ½äº®ç‚¹ <a class="header-anchor" href="#_4-1-åŠŸèƒ½äº®ç‚¹" aria-label="Permalink to &quot;4.1 åŠŸèƒ½äº®ç‚¹&quot;">â€‹</a></h3><ul><li><strong>é«˜ç²¾åº¦é—®ç­”</strong>ï¼šé›†æˆ ç™¾åº¦æ–‡å¿ƒä¸€è¨€ï¼ˆERNIE Botï¼‰ å¤§æ¨¡å‹ APIï¼Œåˆ©ç”¨ ERNIE å¤§æ¨¡å‹å“è¶Šçš„è¯­ä¹‰ç†è§£ä¸ç”Ÿæˆèƒ½åŠ›ï¼Œé…åˆâ€œå‘é‡+å…³é”®è¯â€åŒè·¯æ··åˆæ£€ç´¢ä¸ RRF é‡æ’åºç®—æ³•ï¼Œç¡®ä¿å›ç­”çš„ç²¾å‡†åº¦ä¸é²æ£’æ€§ã€‚</li><li><strong>å¤šçŸ¥è¯†åº“ç®¡ç†</strong>ï¼šæ”¯æŒåŠ¨æ€åˆ›å»ºã€åˆ‡æ¢å’Œåˆ é™¤çŸ¥è¯†åº“ã€‚</li><li><strong>å¬å›ç‡è‡ªæµ‹</strong>ï¼šå†…ç½® <code>test_self_recall</code> å‡½æ•°ï¼Œè‡ªåŠ¨ä»åº“ä¸­æŠ½å–æ ·æœ¬éªŒè¯æ£€ç´¢å‡†ç¡®ç‡ã€‚</li><li><strong>å®æ—¶åé¦ˆ</strong>ï¼šä¸Šä¼ å¤§æ–‡ä»¶æ—¶ï¼Œé€šè¿‡è¿›åº¦æ¡å®æ—¶æ˜¾ç¤º OCR è§£æä¸ Embedding å…¥åº“è¿›åº¦ã€‚</li></ul><h3 id="_4-2-æœªæ¥æ”¹è¿›" tabindex="-1">4.2 æœªæ¥æ”¹è¿› <a class="header-anchor" href="#_4-2-æœªæ¥æ”¹è¿›" aria-label="Permalink to &quot;4.2 æœªæ¥æ”¹è¿›&quot;">â€‹</a></h3><p>é€šè¿‡ç»“åˆ Milvus çš„å‘é‡èƒ½åŠ›ä¸ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…æŠ€æœ¯ï¼Œå¹¶è¾…ä»¥ç»†ç²’åº¦çš„é‡æ’åºç­–ç•¥ï¼Œæœ¬ç³»ç»Ÿåœ¨ä½æˆæœ¬ä¸‹å®ç°äº†è¾ƒé«˜ç²¾åº¦çš„æ–‡æ¡£é—®ç­”ã€‚æœªæ¥çš„ä¼˜åŒ–æ–¹å‘å°†é›†ä¸­åœ¨ï¼š</p><ul><li>å¼•å…¥æœ¬åœ° BGE-Reranker æ¨¡å‹æ›¿ä»£è§„åˆ™æ‰“åˆ†ã€‚</li><li>åˆ©ç”¨æå–çš„å›¾ç‰‡ä¿¡æ¯å¢å¼ºå¤šæ¨¡æ€é—®ç­”èƒ½åŠ›ã€‚</li></ul><h2 id="è‡´è°¢" tabindex="-1">è‡´è°¢ <a class="header-anchor" href="#è‡´è°¢" aria-label="Permalink to &quot;è‡´è°¢&quot;">â€‹</a></h2><p>è¡·å¿ƒæ„Ÿè°¢å¼ æ™¶è€å¸ˆå¸®åŠ©æˆ‘ç†è§£é¡¹ç›®éœ€è¦å®ç°çš„ç›®æ ‡ï¼Œå¹¶ç»™äºˆåœ¨ç³»ç»Ÿè®¾è®¡ä¸å®ç°ç»†èŠ‚ä¸Šçš„æŒ‡å¯¼ï¼Œä½¿å¾—æˆ‘èƒ½å¤Ÿå®Œæˆé¡¹ç›®ã€‚</p><p>æ„Ÿè°¢æ¨æœ‰å¿—è€å¸ˆåœ¨æ˜Ÿæ²³ç¤¾åŒºéƒ¨ç½²ä¸Šçº¿è¿‡ç¨‹ä¸­çš„å¤§åŠ›æ”¯æŒã€‚</p><p>æ„Ÿè°¢ææˆé¾™è€å¸ˆåœ¨ Milvus å‘é‡æ£€ç´¢æ–¹é¢æå‡ºçš„å»ºè®®ã€‚</p><p>å¾ˆè£å¹¸å‚ä¸å¯èˆªè®¡åˆ’ï¼ˆç¬¬ 6 æœŸï¼‰ï¼Œæœªæ¥æˆ‘å°†æŒç»­æ·±è€•ï¼Œä¸ºå¼€æºç¤¾åŒºè´¡çŒ®æ›´å¤šåŠ›é‡ã€‚</p></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 dark:divide-slate-200/5 xl:col-start-1 xl:row-start-2"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Next Article </h2><div class="link"><a href="/posts/xdu-xjtu-os">Open Source in Paddle:é£æ¡¨&amp;è¥¿ç”µ&amp;è¥¿äº¤ â€œä¸è®¾é™â€ äº¤æµæ´»åŠ¨</a></div></div><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500 dark:text-white"> Previous Article </h2><div class="link"><a href="/posts/pactguard-ernie-pp">å†ä¹Ÿä¸é äººè‚‰æ‰¾åˆåŒ&quot;å‘&quot;ï¼šæˆ‘çš„æ™ºèƒ½åˆåŒé£é™©å®¡æŸ¥å…¨æµç¨‹è½åœ°å®å½•</a></div></div><div class="pt-8"><a class="link" href="/">â† Back to the blog</a></div></footer></div></article></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about.md\":\"CzQAAf4V\",\"index.md\":\"AYBfx0e1\",\"pages_1.md\":\"wccGEy_C\",\"pages_2.md\":\"CNyCU79V\",\"pages_3.md\":\"B2EUOUN_\",\"pages_4.md\":\"JDLWzQTr\",\"pages_5.md\":\"wVTJN5qg\",\"pages_6.md\":\"ajK8Xo7n\",\"pages_7.md\":\"D1V8X6Zv\",\"pages_8.md\":\"C9fPTFNT\",\"posts_2023-os-report.md\":\"KoqxymVZ\",\"posts_2024-summary.md\":\"BFc6O-qh\",\"posts_2025-3rd-sw-conf.md\":\"oYRo7W4-\",\"posts_2025wuzhen.md\":\"Dc_dInmo\",\"posts_attention-sharing-sirui.md\":\"CZuKocbE\",\"posts_attnsink-paper-sharing.md\":\"RrNa11ke\",\"posts_buaa-starter.md\":\"DZMcxZ08\",\"posts_build-ernie-websearch.md\":\"NXDkfuT1\",\"posts_ccf-pku.md\":\"DBv8vhzc\",\"posts_chengdu-kaiyuanshe.md\":\"BuU5nIAV\",\"posts_chuan-story.md\":\"UiGi40mG\",\"posts_context-parrel-sharing.md\":\"BIHMolvU\",\"posts_cosyvoice.md\":\"BzDq48dR\",\"posts_decode-sparse-attention-method.md\":\"Ck9FTHi3\",\"posts_deepseek-tech-visualized.md\":\"BKbTJj_v\",\"posts_ernie45-paddleocr-case.md\":\"RR0g2AWK\",\"posts_first-post.md\":\"DfLGbfoW\",\"posts_flashoverlap-paper-sharing.md\":\"DxZQIYNn\",\"posts_flux-paper-sharing.md\":\"BI5_0SX0\",\"posts_glcc-luqi.md\":\"DiK5hFCr\",\"posts_hackathon-5th-episode01.md\":\"Df0O2ch6\",\"posts_hackathon-5th-episode02.md\":\"DljLYSrV\",\"posts_hackathon-5th-episode03.md\":\"B8-h4PLM\",\"posts_hackathon-6th-summary.md\":\"CjII45CK\",\"posts_hackathon-7th-summary.md\":\"BZoGEYXn\",\"posts_high-precision-rag-system.md\":\"CfUn4ZYF\",\"posts_huanggua-story.md\":\"3fmStkaX\",\"posts_huangjiyi-story.md\":\"DnuzI-cZ\",\"posts_ijcai-2024-competition.md\":\"B2ssZ-R3\",\"posts_io-paper-sharing.md\":\"DaAgwrgf\",\"posts_japan-hackathon.md\":\"B4r6pLgQ\",\"posts_kv-cache-drop-for-llm-infer.md\":\"FlfjGRC8\",\"posts_kv-cache-overview.md\":\"BLQqMIXC\",\"posts_lightning-talks.md\":\"CkzvQk5M\",\"posts_ligoml-story.md\":\"DwUUSbET\",\"posts_limin-story.md\":\"Cq3bk9v5\",\"posts_loaf-sharing.md\":\"Cb6ZXW4C\",\"posts_lzj-sharing.md\":\"VfbU8rSL\",\"posts_magiattention-sharing.md\":\"9uhQAeai\",\"posts_medusa.md\":\"CafSgstt\",\"posts_megascale-infer-paper-sharing.md\":\"DdCevYFk\",\"posts_netmoe-paper-sharing.md\":\"CLmhz_8_\",\"posts_newcomers-manual.md\":\"2fGdj5Uh\",\"posts_newhardware-2nd-event.md\":\"DP8zlBFH\",\"posts_nknan-story.md\":\"ClIDCktw\",\"posts_outlier-in-llm-paper-sharing.md\":\"DxJIzetH\",\"posts_pactguard-ernie-pp.md\":\"9blIBKHw\",\"posts_paddle-debug-methods.md\":\"BGwMbwTc\",\"posts_paddle-pipeline-parallel.md\":\"BXrwKs5W\",\"posts_paddle-scnu.md\":\"CsOmY_uw\",\"posts_paddleocr-release.md\":\"BW1kPCNf\",\"posts_paddleocr-vl-for-manga.md\":\"Dw-Lu7qS\",\"posts_pfcc-36th.md\":\"7668E08h\",\"posts_pku-course-2025.md\":\"Bo1xw7zs\",\"posts_pku-course.md\":\"B3Zt9sAI\",\"posts_post-training-overview.md\":\"bo23EEX8\",\"posts_pytorch-conference-01.md\":\"B14UyS7F\",\"posts_sanbu-story.md\":\"BVuipAfQ\",\"posts_shanghai-event.md\":\"ApG0YjGd\",\"posts_shun-story.md\":\"Bbt17jzP\",\"posts_starter-camp-5th.md\":\"5mxEq-BX\",\"posts_starter-camp.md\":\"TdAP6itn\",\"posts_suzhou-kaifangyuanzi.md\":\"CCEtzRNL\",\"posts_swagger-deepseek-r1.md\":\"BLYovS4m\",\"posts_tao-story.md\":\"VncVwA3l\",\"posts_type-hints-project.md\":\"BYrNy-i6\",\"posts_vattention-paper-sharing.md\":\"CXLeYUSG\",\"posts_wangxin-story.md\":\"B1ojKWVC\",\"posts_wuxi-kaifangyuanzi.md\":\"DVani9MK\",\"posts_xdoctest-project.md\":\"D1YjEXRk\",\"posts_xdu-xjtu-os.md\":\"CF04UOFz\",\"posts_xian-event.md\":\"DSOIzACM\",\"posts_yanguohao-story.md\":\"Caxzgkds\",\"posts_yinfan-story.md\":\"BQD8IBpP\",\"posts_zhangyiqiao-story.md\":\"D5MUTeFE\",\"posts_zheng-story.md\":\"Brmo3hBv\",\"posts_zju-event.md\":\"CTI-BvwC\",\"posts_zju-se-os.md\":\"D4JHDafp\",\"posts_zuckerberg-letter-post.md\":\"CHMyePoL\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"é£æ¡¨å¼€æºç¤¾åŒºåšå®¢\",\"description\":\"Wonderful stories from PaddlePaddle contributors\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"postsPerPage\":10},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>