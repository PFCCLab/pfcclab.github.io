import{_ as n,c as t,m as a,a as Q,L as m,o as l}from"./chunks/framework.CcfPirFf.js";const e="/assets/background.DuM0176Y.jpg",s="/assets/utilization.Ll9Razpo.jpg",d="/assets/architecture.3844cLX9.jpg",r="/assets/hardware.CceElghp.jpg",o="/assets/pipeline.85Wbk7ng.jpg",H="/assets/searching.-TS8AhC8.jpg",i="/assets/benchmark.CZamj0Jc.jpg",g="/assets/sender_receiver.A-wdjmXC.jpg",p="/assets/throughput.FmMTmsh0.jpg",h="/assets/latency-data.m6TDDrYc.jpg",L="/assets/latency-num.BcRZ5IKu.jpg",W=JSON.parse('{"title":"【论文分享】｜MegaScale-Infer：分离注意力层和专家层来提高专家层的计算利用率","description":"","frontmatter":{"title":"【论文分享】｜MegaScale-Infer：分离注意力层和专家层来提高专家层的计算利用率","date":"2025-06-13T00:00:00.000Z","author":{"name":"陈煜彦","github":"cyy536"},"category":"insights"},"headers":[],"relativePath":"posts/megascale-infer-paper-sharing.md","filePath":"posts/megascale-infer-paper-sharing.md"}'),u={name:"posts/megascale-infer-paper-sharing.md"},c={id:"mjx-2f7f685"},V={class:"MathJax",jax:"SVG",style:{position:"relative"}},f={style:{"vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.627ex",height:"1.889ex",role:"img",focusable:"false",viewBox:"0 -677 3371.1 834.8","aria-hidden":"true"},M={id:"mjx-d4f8824"},Z={class:"MathJax",jax:"SVG",style:{position:"relative"}},x={style:{"vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.608ex",height:"2.199ex",role:"img",focusable:"false",viewBox:"0 -677 3362.6 972","aria-hidden":"true"},_={id:"mjx-eda602c"},b={class:"MathJax",jax:"SVG",style:{position:"relative"}},D={style:{"vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"17.495ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 7732.7 1045","aria-hidden":"true"},w={id:"mjx-f400263"},j={class:"MathJax",jax:"SVG",style:{position:"relative"}},y={style:{"vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.172ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 10241.9 1045","aria-hidden":"true"},v={id:"mjx-6283a55"},C={class:"MathJax",jax:"SVG",display:"true",style:{position:"relative"}},A={style:{"vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"46.066ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 20361.2 1045","aria-hidden":"true"},P={id:"mjx-529e50d"},k={class:"MathJax",jax:"SVG",display:"true",style:{position:"relative"}},S={style:{"vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"37.389ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 16525.8 1045","aria-hidden":"true"},R={id:"mjx-9d1d2db"},E={class:"MathJax",jax:"SVG",display:"true",style:{position:"relative"}},N={style:{"vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.992ex",height:"2.034ex",role:"img",focusable:"false",viewBox:"0 -705 5300.3 899","aria-hidden":"true"},F={id:"mjx-5082192"},O={class:"MathJax",jax:"SVG",display:"true",style:{position:"relative"}},I={style:{"vertical-align":"-2.016ex"},xmlns:"http://www.w3.org/2000/svg",width:"25.36ex",height:"5.115ex",role:"img",focusable:"false",viewBox:"0 -1370 11208.9 2261","aria-hidden":"true"},B={id:"mjx-a87866a"},G={class:"MathJax",jax:"SVG",display:"true",style:{position:"relative"}},q={style:{"vertical-align":"-1.991ex"},xmlns:"http://www.w3.org/2000/svg",width:"26.626ex",height:"5.294ex",role:"img",focusable:"false",viewBox:"0 -1460 11768.6 2340","aria-hidden":"true"};function X(J,T,z,U,K,$){return l(),t("div",null,[T[26]||(T[26]=a("",26)),Q("ol",null,[Q("li",null,[Q("span",c,[Q("mjx-container",V,[(l(),t("svg",f,[...T[0]||(T[0]=[a("",1)])])),T[1]||(T[1]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"≈"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")])])],-1))])]),T[2]||(T[2]=Q("ul",null,[Q("li",null,"计算时间平衡，减少空闲")],-1))]),Q("li",null,[Q("span",M,[Q("mjx-container",Z,[(l(),t("svg",x,[...T[3]||(T[3]=[a("",1)])])),T[4]||(T[4]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")])])],-1))])]),T[7]||(T[7]=m(" ，其中 ",-1)),Q("span",_,[Q("mjx-container",b,[(l(),t("svg",D,[...T[5]||(T[5]=[a("",1)])])),T[6]||(T[6]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"="),Q("mo",{"data-mjx-texclass":"OP",movablelimits:"true"},"max"),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",{fence:"false",stretchy:"false"},"}")])],-1))])]),T[8]||(T[8]=m(" 。 ",-1)),T[9]||(T[9]=Q("ul",null,[Q("li",null,"计算时间大于通信时间")],-1))]),Q("li",null,[Q("span",w,[Q("mjx-container",j,[(l(),t("svg",y,[...T[10]||(T[10]=[a("",1)])])),T[11]||(T[11]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"m"),Q("mo",null,"×"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"≥"),Q("mn",null,"2"),Q("mo",null,"×"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")")])],-1))])]),T[19]||(T[19]=m(" 。 ",-1)),Q("ul",null,[Q("li",null,[T[18]||(T[18]=m("global-batch 经过 Attention/FFN 层的时间要大于 micro batch 经过两者的时间之和，否则有空闲，要求 micro-batch 数量足够多 ",-1)),Q("ul",null,[Q("li",null,[T[14]||(T[14]=m("micro-batch 时延： ",-1)),Q("span",v,[Q("mjx-container",C,[(l(),t("svg",A,[...T[12]||(T[12]=[a("",1)])])),T[13]||(T[13]=Q("mjx-assistive-mml",{unselectable:"on",display:"block"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"+"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"L"),Q("mo",null,"−"),Q("mn",null,"1"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"≤"),Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"iter")])]),Q("mo",null,"≤"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mi",null,"L"),Q("mo",null,".")])],-1))])])]),Q("li",null,[T[17]||(T[17]=m("global-batch 时延： ",-1)),Q("span",P,[Q("mjx-container",k,[(l(),t("svg",S,[...T[15]||(T[15]=[a("",1)])])),T[16]||(T[16]=Q("mjx-assistive-mml",{unselectable:"on",display:"block"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"total")])]),Q("mo",null,"="),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"m"),Q("mi",null,"L"),Q("mo",null,"−"),Q("mn",null,"1"),Q("mo",{stretchy:"false"},")")])],-1))])])])])])])])]),T[27]||(T[27]=Q("p",null,[m("设计流水线需要确定一些超参，设计了一个"),Q("strong",null,"超参数搜索"),m("的算法，其搜索空间包括 Attention Node 和 Expert Node 的张量并行度大小，micro-batch 数量（m），单位成本的吞吐量作为优化目标。")],-1)),T[28]||(T[28]=Q("p",null,[Q("img",{src:H,alt:"alt text"})],-1)),T[29]||(T[29]=Q("p",null,"时延要求和 KV 显存限制：",-1)),Q("span",R,[Q("mjx-container",E,[(l(),t("svg",N,[...T[20]||(T[20]=[a("",1)])])),T[21]||(T[21]=Q("mjx-assistive-mml",{unselectable:"on",display:"block"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"iter")])]),Q("mo",null,"≤"),Q("mtext",null,"SLO"),Q("mo",null,",")])],-1))])]),Q("span",F,[Q("mjx-container",O,[(l(),t("svg",I,[...T[22]||(T[22]=[a("",1)])])),T[23]||(T[23]=Q("mjx-assistive-mml",{unselectable:"on",display:"block"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mfrac",null,[Q("mrow",null,[Q("mn",null,"4"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"b"),Q("mi",null,"a")]),Q("mi",null,"s"),Q("mi",null,"h"),Q("mi",null,"L")]),Q("mi",null,"g")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"P"),Q("mi",null,"a")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"p"),Q("mi",null,"a")])]),Q("msub",null,[Q("mi",null,"C"),Q("mi",null,"a")]),Q("mo",null,".")])],-1))])]),T[30]||(T[30]=Q("p",null,"目标：",-1)),Q("span",B,[Q("mjx-container",G,[(l(),t("svg",q,[...T[24]||(T[24]=[a("",1)])])),T[25]||(T[25]=Q("mjx-assistive-mml",{unselectable:"on",display:"block"},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"B"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"/")]),Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"total")])])]),Q("mrow",null,[Q("mi",null,"t"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("msub",null,[Q("mi",null,"n"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"C"),Q("mi",null,"o"),Q("mi",null,"s"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mo",null,"+"),Q("mi",null,"t"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"e")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"E"),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"C"),Q("mi",null,"o"),Q("mi",null,"s"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"e")])])])])])],-1))])]),T[31]||(T[31]=a("",22))])}const Q1=n(u,[["render",X]]);export{W as __pageData,Q1 as default};
