import{_ as l,c as e,q as a,a as Q,N as T,o as s}from"./chunks/framework.BRsttz9t.js";const o="/assets/magi_1.0QHPigf1.png",n="/assets/magi_2.Do5-j_Fn.png",r="/assets/magi_3.AKv46i1B.png",m="/assets/magi_4.DrDnhzGn.png",d="/assets/magi_5.DN4A1By2.png",i="/assets/magi_6.slqhsavG.png",p="/assets/magi_7.B_Mr_Ejb.png",h="/assets/magi_8.D7FC_y_U.png",g="/assets/magi_9.CvYRxU-F.png",c="/assets/magi_10.Cmz-K76x.png",H="/assets/magi_11.AbqoDIg3.png",u="/assets/magi_12.hscOx_p0.png",w="/assets/magi_13.BeA5t1_Y.png",L="/assets/magi_14.BpHsZOhQ.png",x="/assets/magi_15.CDNREJpk.png",f="/assets/magi_16.Bl3Ej-vy.png",M="/assets/magi_17.Cvw4qz-x.png",k="/assets/magi_18.h2j3FQHh.png",y="/assets/magi_19.CJUXIu__.png",V="/assets/magi_20.ol6V-PWG.png",Z="/assets/magi_21.BsPRinI3.png",_="/assets/magi_22.DrZKh9Kq.png",b="/assets/magi_23.CJSf0VVc.png",D="/assets/magi_24.CGKrZbmc.png",v="/assets/magi_25.Ce0bidHw.png",A="/assets/magi_26.Dr_sLn6Q.png",C="/assets/magi_27.DAvSkJQd.png",u1=JSON.parse('{"title":"【论文分享】｜ 序列并行视角下的各类研究","description":"","frontmatter":{"title":"【论文分享】｜ 序列并行视角下的各类研究","date":"2025-06-17T00:00:00.000Z","author":{"name":"王飒","github":"OrangeEarth15"},"category":"insights"},"headers":[],"relativePath":"posts/magiattention-sharing.md","filePath":"posts/magiattention-sharing.md"}'),S={name:"posts/magiattention-sharing.md"},j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.952ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2630.7 1000","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.662ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2502.7 1000","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.777ex",height:"2.032ex",role:"img",focusable:"false",viewBox:"0 -704 1227.6 898","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.858ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 2589.4 727","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},N={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.858ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 2589.4 727","aria-hidden":"true"},F={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.858ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 2589.4 727","aria-hidden":"true"},K={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.858ex",height:"1.645ex",role:"img",focusable:"false",viewBox:"0 -705 2589.4 727","aria-hidden":"true"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.375ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.714ex",height:"1.967ex",role:"img",focusable:"false",viewBox:"0 -704 1199.6 869.6","aria-hidden":"true"},$={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},W={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.375ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.714ex",height:"1.967ex",role:"img",focusable:"false",viewBox:"0 -704 1199.6 869.6","aria-hidden":"true"},Y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.11ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 3142.8 1000","aria-hidden":"true"},t1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.662ex"},xmlns:"http://www.w3.org/2000/svg",width:"32.857ex",height:"2.566ex",role:"img",focusable:"false",viewBox:"0 -841.7 14522.9 1134.1","aria-hidden":"true"},a1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.666ex"},xmlns:"http://www.w3.org/2000/svg",width:"41.536ex",height:"2.57ex",role:"img",focusable:"false",viewBox:"0 -841.7 18358.9 1136","aria-hidden":"true"},s1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},l1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.682ex"},xmlns:"http://www.w3.org/2000/svg",width:"75.198ex",height:"3.082ex",role:"img",focusable:"false",viewBox:"0 -1060.7 33237.5 1362.3","aria-hidden":"true"},o1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"68.413ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 30238.8 1000","aria-hidden":"true"},r1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.52ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1998 1000","aria-hidden":"true"};function d1(i1,t,p1,h1,g1,c1){return s(),e("div",null,[t[56]||(t[56]=a("",9)),Q("p",null,[t[18]||(t[18]=T("Ring Attention 可以理解为分布式版本的 Flash Attention。设 Q、K、V 的尺寸均为 ",-1)),Q("mjx-container",j,[(s(),e("svg",R,[...t[0]||(t[0]=[a("",1)])])),t[1]||(t[1]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"N"),Q("mo",null,","),Q("mi",null,"d"),Q("mo",{stretchy:"false"},")")])],-1))]),t[19]||(t[19]=T("，其中 N 表示序列长度 seq",-1)),t[20]||(t[20]=Q("em",null,"len, d 为隐藏维度（hidden",-1)),t[21]||(t[21]=T("size）。在分布式场景下，假设 Q、K、V 都顺序切分成了 4 个块，每块大小为 ",-1)),Q("mjx-container",P,[(s(),e("svg",E,[...t[2]||(t[2]=[a("",1)])])),t[3]||(t[3]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"C"),Q("mo",null,","),Q("mi",null,"d"),Q("mo",{stretchy:"false"},")")])],-1))]),t[22]||(t[22]=T("（其中 C = N/4），每个 GPU 或设备各自保存一份 Q、K、V 的分块。 在具体计算时，例如对于第一个 Q 分块（假定为 ",-1)),Q("mjx-container",I,[(s(),e("svg",O,[...t[4]||(t[4]=[a("",1)])])),t[5]||(t[5]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"Q"),Q("mn",null,"0")])])],-1))]),t[23]||(t[23]=T("），会依次与 4 个 K、V 分块对应计算打分和 softmax 加权和，即先算 ",-1)),Q("mjx-container",G,[(s(),e("svg",B,[...t[6]||(t[6]=[a("",1)])])),t[7]||(t[7]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"S"),Q("mo",null,"∗"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"00")])])],-1))]),t[24]||(t[24]=T("，再是 ",-1)),Q("mjx-container",q,[(s(),e("svg",N,[...t[8]||(t[8]=[a("",1)])])),t[9]||(t[9]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"S"),Q("mo",null,"∗"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"01")])])],-1))]),t[25]||(t[25]=T("、",-1)),Q("mjx-container",F,[(s(),e("svg",z,[...t[10]||(t[10]=[a("",1)])])),t[11]||(t[11]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"S"),Q("mo",null,"∗"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"02")])])],-1))]),t[26]||(t[26]=T("、",-1)),Q("mjx-container",K,[(s(),e("svg",J,[...t[12]||(t[12]=[a("",1)])])),t[13]||(t[13]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"S"),Q("mo",null,"∗"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mn",null,"03")])])],-1))]),t[27]||(t[27]=T("，并按照同样的顺序对对应的输出 ",-1)),Q("mjx-container",U,[(s(),e("svg",X,[...t[14]||(t[14]=[a("",1)])])),t[15]||(t[15]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"O"),Q("mn",null,"0")])])],-1))]),t[28]||(t[28]=T(" 进行在线（online）更新。实际上，这个更新顺序可以是任意的——只要每次合成输出时都能够获得当前分块的输出 ",-1)),Q("mjx-container",$,[(s(),e("svg",W,[...t[16]||(t[16]=[a("",1)])])),t[17]||(t[17]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"O"),Q("mn",null,"0")])])],-1))]),t[29]||(t[29]=T("，以及累计的最大值（max）和归一化累积和（sum）等辅助信息，最终的结果不会受到顺序的影响。这一性质本质上源自 softmax 归一化的数学定义以及 online 累加的加性与稳定性。",-1))]),t[57]||(t[57]=a("",19)),Q("ul",null,[Q("li",null,[t[36]||(t[36]=T("能量函数：Tree Attention 的核心数学基础是将标准注意力计算重新表述为一个能量函数的梯度。对于单个查询向量 ",-1)),t[37]||(t[37]=Q("em",null,"q",-1)),t[38]||(t[38]=T(" 和分布在多个设备上的键/值对 ",-1)),Q("mjx-container",Y,[(s(),e("svg",Q1,[...t[30]||(t[30]=[a("",1)])])),t[31]||(t[31]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"k"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"a")]),Q("mo",{stretchy:"false"},")")])],-1))]),t[39]||(t[39]=T("，其能量函数定义为：",-1)),Q("mjx-container",t1,[(s(),e("svg",T1,[...t[32]||(t[32]=[a("",1)])])),t[33]||(t[33]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"F"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"ζ"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("mi",null,"l"),Q("mi",null,"o"),Q("mi",null,"g"),Q("msub",null,[Q("mo",null,"∑"),Q("mi",null,"a")]),Q("mi",null,"e"),Q("mi",null,"x"),Q("mi",null,"p"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"q"),Q("mo",null,"⋅"),Q("msubsup",null,[Q("mi",null,"k"),Q("mi",null,"a"),Q("mi",null,"T")]),Q("mo",null,"+"),Q("mi",null,"ζ"),Q("mo",null,"⋅"),Q("msubsup",null,[Q("mi",null,"v"),Q("mi",null,"a"),Q("mi",null,"T")]),Q("mo",{stretchy:"false"},")")])],-1))]),t[40]||(t[40]=T("。其中 ",-1)),t[41]||(t[41]=Q("em",null,"ζ",-1)),t[42]||(t[42]=T(" 是一个辅助的源向量。Tree Attention 的关键观察是，标准注意力的输出（即值向量的加权和）恰好等于该能量函数在 ",-1)),t[43]||(t[43]=Q("em",null,"ζ = 0",-1)),t[44]||(t[44]=T(" 处的梯度 ",-1)),Q("mjx-container",a1,[(s(),e("svg",e1,[...t[34]||(t[34]=[a("",1)])])),t[35]||(t[35]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"z"),Q("mo",null,"="),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"∂")]),Q("mi",null,"F"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"ζ"),Q("mo",{stretchy:"false"},")"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"/")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"∂")]),Q("mi",null,"ζ"),Q("msub",null,[Q("mo",{"data-mjx-texclass":"ORD",stretchy:"false"},"|"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"ζ"),Q("mo",null,"="),Q("mn",null,"0")])]),Q("mo",null,"="),Q("msub",null,[Q("mo",null,"∑"),Q("mi",null,"a")]),Q("mi",null,"s"),Q("mi",null,"o"),Q("mi",null,"f"),Q("mi",null,"t"),Q("mi",null,"m"),Q("mi",null,"a"),Q("mi",null,"x"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"q"),Q("mo",null,"⋅"),Q("msubsup",null,[Q("mi",null,"k"),Q("mi",null,"a"),Q("mi",null,"T")]),Q("mo",{stretchy:"false"},")"),Q("msub",null,[Q("mi",null,"v"),Q("mi",null,"a")])])],-1))]),t[45]||(t[45]=T("。",-1))]),Q("li",null,[t[48]||(t[48]=T("Softmax 通过迭代来进行计算：",-1)),Q("mjx-container",s1,[(s(),e("svg",l1,[...t[46]||(t[46]=[a("",1)])])),t[47]||(t[47]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"s"),Q("mo",null,"∗"),Q("msup",null,[Q("mi",null,"i"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,"="),Q("mi",null,"exp"),Q("mo",{"data-mjx-texclass":"NONE"},"⁡"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"q"),Q("mi",null,"j")]),Q("mo",null,"⋅"),Q("msub",null,[Q("mi",null,"k"),Q("mi",null,"i")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,","),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"1em"})]),Q("msubsup",null,[Q("mi",null,"n"),Q("mi",null,"i"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,"="),Q("mi",null,"n"),Q("mo",null,"∗"),Q("msup",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"−"),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,"+"),Q("mi",null,"v"),Q("mo",null,"∗"),Q("mi",null,"i"),Q("msubsup",null,[Q("mi",null,"s"),Q("mi",null,"i"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,","),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"1em"})]),Q("msubsup",null,[Q("mi",null,"d"),Q("mi",null,"i"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,"="),Q("mi",null,"d"),Q("mo",null,"∗"),Q("msup",null,[Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"i"),Q("mo",null,"−"),Q("mn",null,"1")]),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])]),Q("mo",null,"+"),Q("msubsup",null,[Q("mi",null,"s"),Q("mi",null,"i"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",{stretchy:"false"},"("),Q("mi",null,"j"),Q("mo",{stretchy:"false"},")")])])])],-1))])]),Q("li",null,[t[51]||(t[51]=T("logsumexp 和 max 操作具备结合律：",-1)),Q("mjx-container",o1,[(s(),e("svg",n1,[...t[49]||(t[49]=[a("",1)])])),t[50]||(t[50]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mtext",null,"logsumexp"),Q("mi",null,"a")]),Q("mo",{stretchy:"false"},"("),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mtext",null,"logsumexp"),Q("mi",null,"a")]),Q("mo",{stretchy:"false"},"("),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"S"),Q("mi",null,"a")]),Q("mo",{fence:"false",stretchy:"false"},"}"),Q("mo",{stretchy:"false"},")"),Q("mo",{fence:"false",stretchy:"false"},"}"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"="),Q("msub",null,[Q("mtext",null,"logsumexp"),Q("mi",null,"a")]),Q("mo",{stretchy:"false"},"("),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"R"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"S"),Q("mi",null,"a")]),Q("mo",{fence:"false",stretchy:"false"},"}"),Q("mo",{stretchy:"false"},")")])],-1))])])]),t[58]||(t[58]=Q("p",null,[Q("img",{src:c,alt:""})],-1)),Q("p",null,[t[54]||(t[54]=T("进而得到 motivation：能量函数的公式关系表明，只要能高效计算能量函数 ",-1)),Q("mjx-container",r1,[(s(),e("svg",m1,[...t[52]||(t[52]=[a("",1)])])),t[53]||(t[53]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"F"),Q("mo",{stretchy:"false"},"("),Q("mi",null,"ζ"),Q("mo",{stretchy:"false"},")")])],-1))]),t[55]||(t[55]=T(" 或其梯度，即可精确得到注意力输出。而 logsumexp 和 max 操作具备结合律，进一步使得传输不需要传 kv cache，而是只需要通过具备结合律的 op 下的 allreduce 来完成 lse 的聚合，进而通过 Softmax 通过迭代来进行计算，来得到最终的结果，同时和 FlashAttention-2 进行结合。而 Allreduce 通过树形的 Tree reduce 使得相比 Ring Attention 的 O(p)的通信步骤降低到 O(log p)。（p 为整个拓扑中节点的数量）",-1))]),t[59]||(t[59]=a("",52))])}const w1=l(S,[["render",d1]]);export{u1 as __pageData,w1 as default};
