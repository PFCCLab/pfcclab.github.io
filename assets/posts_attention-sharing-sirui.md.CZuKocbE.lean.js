import{_ as o,c as s,q as l,a as t,N as e,o as n}from"./chunks/framework.BRsttz9t.js";const a="/assets/mha.BJRlaZVA.png",T="/assets/mla.BiTZsUeo.png",i="/assets/trans.Ca15I97b.png",r="/assets/gta.5a_vTZaC.png",d="/assets/gla.9YK_iv8i.png",p1=JSON.parse('{"title":"【论文分享】｜面向长文本的高效Attention基础结构设计","description":"","frontmatter":{"title":"【论文分享】｜面向长文本的高效Attention基础结构设计","date":"2025-06-24T00:00:00.000Z","author":{"name":"陶思睿","github":"Siritao"},"category":"insights"},"headers":[],"relativePath":"posts/attention-sharing-sirui.md","filePath":"posts/attention-sharing-sirui.md"}'),m={name:"posts/attention-sharing-sirui.md"},p={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.227ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 984.3 981.2","aria-hidden":"true"},g={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.003ex",height:"1.65ex",role:"img",focusable:"false",viewBox:"0 -442 885.3 729.2","aria-hidden":"true"},x={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.227ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 984.3 981.2","aria-hidden":"true"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.124ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 2706.7 981.2","aria-hidden":"true"},f={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.003ex",height:"1.65ex",role:"img",focusable:"false",viewBox:"0 -442 885.3 729.2","aria-hidden":"true"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},v={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.282ex",height:"2.157ex",role:"img",focusable:"false",viewBox:"0 -666 3218.8 953.2","aria-hidden":"true"},H={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.478ex",height:"2.347ex",role:"img",focusable:"false",viewBox:"0 -750 5073.4 1037.2","aria-hidden":"true"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.003ex",height:"1.65ex",role:"img",focusable:"false",viewBox:"0 -442 885.3 729.2","aria-hidden":"true"},A={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.003ex",height:"1.65ex",role:"img",focusable:"false",viewBox:"0 -442 885.3 729.2","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.184ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 965.2 851.8","aria-hidden":"true"},C={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},P={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.184ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 965.2 851.8","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},j={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.257ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 4975.5 851.8","aria-hidden":"true"},E={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},G={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.183ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 2732.7 851.8","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.339ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 3243.7 888","aria-hidden":"true"},q={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"19.279ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 8521.5 851.8","aria-hidden":"true"},K={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},N={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.183ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 2732.7 851.8","aria-hidden":"true"},J={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.183ex",height:"1.927ex",role:"img",focusable:"false",viewBox:"0 -694 2732.7 851.8","aria-hidden":"true"},O={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},F={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.288ex",height:"2.157ex",role:"img",focusable:"false",viewBox:"0 -666 3663.5 953.2","aria-hidden":"true"},$={tabindex:"0"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.227ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 984.3 981.2","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.003ex",height:"1.65ex",role:"img",focusable:"false",viewBox:"0 -442 885.3 729.2","aria-hidden":"true"},t1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.358ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 1484.3 981.2","aria-hidden":"true"},e1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},l1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.358ex",height:"2.22ex",role:"img",focusable:"false",viewBox:"0 -694 1484.3 981.2","aria-hidden":"true"},s1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.134ex",height:"2.157ex",role:"img",focusable:"false",viewBox:"0 -666 1385.3 953.2","aria-hidden":"true"};function o1(a1,Q,T1,i1,r1,d1){return n(),s("div",null,[Q[129]||(Q[129]=l("",7)),t("ol",null,[t("li",null,[Q[2]||(Q[2]=e("模型的 attention 计算量只与 ",-1)),t("mjx-container",p,[(n(),s("svg",u,[...Q[0]||(Q[0]=[l("",1)])])),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[3]||(Q[3]=e(" 有关。",-1))]),t("li",null,[Q[10]||(Q[10]=e("KV 头数的压缩带来两个好处： a) 直接减少缓存量，容纳更长文本、更大 batch； b) 在容易 memory bound 的推理场景下提高计算密度。GQA 的计算密度为 ",-1)),t("mjx-container",g,[(n(),s("svg",h,[...Q[4]||(Q[4]=[l("",1)])])),Q[5]||(Q[5]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[11]||(Q[11]=e("，MQA 和 MLA 分别为 ",-1)),t("mjx-container",x,[(n(),s("svg",w,[...Q[6]||(Q[6]=[l("",1)])])),Q[7]||(Q[7]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[12]||(Q[12]=e(" 和 ",-1)),t("mjx-container",L,[(n(),s("svg",b,[...Q[8]||(Q[8]=[l("",1)])])),Q[9]||(Q[9]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("mo",null,"×"),t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[13]||(Q[13]=e("（由于 RoPE dim 的存在，实际略小）。",-1))]),Q[24]||(Q[24]=t("li",null,[e("固定 KV cache 大小下，模型的理论 expressiveness 大小关系：GQA < MLA < MQA。基于此，已有 TransMLA 等工作。 "),t("img",{src:i,alt:"trans"})],-1)),t("li",null,[Q[19]||(Q[19]=e("考虑并行性： ",-1)),t("ul",null,[t("li",null,[Q[16]||(Q[16]=e("GQA 可以受限地 TP（取决于 ",-1)),t("mjx-container",f,[(n(),s("svg",M,[...Q[14]||(Q[14]=[l("",1)])])),Q[15]||(Q[15]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[17]||(Q[17]=e("）。",-1))]),Q[18]||(Q[18]=t("li",null,"MLA、MQA 常采用 DP Attention（或 TP+DP，TP 会冗余复制 KV cache，而 DP 则会冗余复制 Attention 权重）；序列并行不受影响。",-1))])]),t("li",null,[Q[22]||(Q[22]=e("考虑推理友好性，MQA、MLA 和 ",-1)),t("mjx-container",k,[(n(),s("svg",v,[...Q[20]||(Q[20]=[l("",1)])])),Q[21]||(Q[21]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")]),t("mo",null,">"),t("mn",null,"16")])],-1))]),Q[23]||(Q[23]=e(" 的 GQA 可以在推理场景下充分使用 tensor core。",-1))])]),Q[130]||(Q[130]=l("",5)),t("ul",null,[Q[33]||(Q[33]=t("li",null,[t("strong",null,"计算强度是关键指标"),e("：定义为计算量（FLOPs）与内存访问量（Bytes）之比。解码阶段需最大化算术强度（更多计算/字节），使计算从内存受限转向计算受限，充分利用 GPU 算力。")],-1)),t("li",null,[Q[29]||(Q[29]=t("strong",null,"组大小是杠杆",-1)),Q[30]||(Q[30]=e("：",-1)),t("mjx-container",H,[(n(),s("svg",y,[...Q[25]||(Q[25]=[l("",1)])])),Q[26]||(Q[26]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")]),t("mo",null,"="),t("msub",null,[t("mi",null,"h"),t("mi",null,"q")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msub",null,[t("mi",null,"h"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"k"),t("mi",null,"v")])])])],-1))]),Q[31]||(Q[31]=e("。增大 ",-1)),t("mjx-container",V,[(n(),s("svg",c,[...Q[27]||(Q[27]=[l("",1)])])),Q[28]||(Q[28]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[32]||(Q[32]=e(" 可提高算术强度、减小 KV 缓存，但过大会损害并行性（需跨设备复制权重和缓存）。",-1))]),Q[34]||(Q[34]=t("li",null,[t("strong",null,"KV 复用与并行友好"),e("：理想方案需同时实现高算术强度、高效跨设备并行（零冗余或低冗余），且不牺牲模型质量。")],-1))]),Q[131]||(Q[131]=t("h3",{id:"提出的解决方案-两种新型注意力机制",tabindex:"-1"},[e("提出的解决方案：两种新型注意力机制 "),t("a",{class:"header-anchor",href:"#提出的解决方案-两种新型注意力机制","aria-label":'Permalink to "提出的解决方案：两种新型注意力机制"'},"​")],-1)),Q[132]||(Q[132]=t("h4",{id:"grouped-tied-attention-gta",tabindex:"-1"},[e("Grouped-Tied Attention (GTA) "),t("a",{class:"header-anchor",href:"#grouped-tied-attention-gta","aria-label":'Permalink to "Grouped-Tied Attention (GTA)"'},"​")],-1)),t("ul",null,[Q[44]||(Q[44]=t("li",null,[t("strong",null,"核心思想"),e("：在 GQA 分组基础上，将 Key 和 Value 状态绑定（Tie）为一个共享状态，并仅对 Key 的部分维度应用位置编码（RoPE）。 "),t("img",{src:r,alt:"gta"})],-1)),Q[45]||(Q[45]=t("li",null,[t("strong",null,"实现"),e("： "),t("ol",null,[t("li",null,"一个投影生成绑定 KV 状态（形状同单个 K 或 V 向量）。"),t("li",null,"Value 路径使用整个绑定 KV 状态。"),t("li",null,"Key 路径使用绑定 KV 状态的前半部分（不应用 RoPE） + 一个单独的单头投影（应用 RoPE）广播拼接而成。")])],-1)),t("li",null,[Q[42]||(Q[42]=t("strong",null,"优势",-1)),Q[43]||(Q[43]=e("： ",-1)),t("ul",null,[t("li",null,[Q[37]||(Q[37]=e("相比同 ",-1)),t("mjx-container",A,[(n(),s("svg",_,[...Q[35]||(Q[35]=[l("",1)])])),Q[36]||(Q[36]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[38]||(Q[38]=e(" 的 GQA，KV 缓存减半（因 K 和 V 共享状态）。",-1))]),Q[39]||(Q[39]=t("li",null,"算术强度翻倍（加载一次状态用于 K 和 V 计算）。",-1)),Q[40]||(Q[40]=t("li",null,"保持 GQA 的并行友好性。",-1)),Q[41]||(Q[41]=t("li",null,"实验证明质量匹配或优于 GQA（如 1.47B 模型，GTA-4 困惑度 10.12 vs GQA-4 的 10.20）。",-1))])])]),Q[133]||(Q[133]=t("h4",{id:"grouped-latent-attention-gla",tabindex:"-1"},[e("Grouped Latent Attention (GLA) "),t("a",{class:"header-anchor",href:"#grouped-latent-attention-gla","aria-label":'Permalink to "Grouped Latent Attention (GLA)"'},"​")],-1)),t("ul",null,[t("li",null,[Q[48]||(Q[48]=t("strong",null,"核心思想",-1)),Q[49]||(Q[49]=e("：改进 MLA，将潜在表示分组（",-1)),t("mjx-container",Z,[(n(),s("svg",S,[...Q[46]||(Q[46]=[l("",1)])])),Q[47]||(Q[47]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"c")])])],-1))]),Q[50]||(Q[50]=e(" 组），每组服务一个查询头子集，并减小每组潜在头维度。 ",-1)),Q[51]||(Q[51]=t("img",{src:d,alt:"gla"},null,-1))]),t("li",null,[Q[67]||(Q[67]=t("strong",null,"实现",-1)),Q[68]||(Q[68]=e("： ",-1)),t("ol",null,[t("li",null,[Q[58]||(Q[58]=e("压缩 token 为 ",-1)),t("mjx-container",C,[(n(),s("svg",P,[...Q[52]||(Q[52]=[l("",1)])])),Q[53]||(Q[53]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"c")])])],-1))]),Q[59]||(Q[59]=e(" 个潜在头（而非 MLA 的单个头），每个头维度 ",-1)),t("mjx-container",D,[(n(),s("svg",j,[...Q[54]||(Q[54]=[l("",1)])])),Q[55]||(Q[55]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"d"),t("mi",null,"c")]),t("mo",null,"="),t("mn",null,"2"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])])],-1))]),Q[60]||(Q[60]=e("（MLA 为 ",-1)),t("mjx-container",E,[(n(),s("svg",G,[...Q[56]||(Q[56]=[l("",1)])])),Q[57]||(Q[57]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"4"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])])],-1))]),Q[61]||(Q[61]=e("）。",-1))]),Q[66]||(Q[66]=t("li",null,"每个潜在头及其上投影矩阵重建其组内查询头的独立 K/V 特征。",-1)),t("li",null,[Q[64]||(Q[64]=e("解码时，潜在头可跨 TP 设备分片（如 ",-1)),t("mjx-container",I,[(n(),s("svg",R,[...Q[62]||(Q[62]=[l("",1)])])),Q[63]||(Q[63]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"c")]),t("mo",null,"="),t("mtext",null,"tp")])],-1))]),Q[65]||(Q[65]=e(" 时零冗余）。",-1))])])]),t("li",null,[Q[85]||(Q[85]=t("strong",null,"优势",-1)),Q[86]||(Q[86]=e("： ",-1)),t("ul",null,[t("li",null,[Q[75]||(Q[75]=e("与 MLA 总缓存相当（如 GLA-2 缓存 ",-1)),t("mjx-container",q,[(n(),s("svg",B,[...Q[69]||(Q[69]=[l("",1)])])),Q[70]||(Q[70]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("mo",null,"×"),t("mn",null,"2"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")]),t("mo",null,"="),t("mn",null,"4"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])])],-1))]),Q[76]||(Q[76]=e("），但 TP 时每个设备缓存减半（如 TP=2 时，GLA-2 每设备缓存 ",-1)),t("mjx-container",K,[(n(),s("svg",N,[...Q[71]||(Q[71]=[l("",1)])])),Q[72]||(Q[72]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])])],-1))]),Q[77]||(Q[77]=e(" vs MLA 的 ",-1)),t("mjx-container",J,[(n(),s("svg",z,[...Q[73]||(Q[73]=[l("",1)])])),Q[74]||(Q[74]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"4"),t("mo",null,"×"),t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])])],-1))]),Q[78]||(Q[78]=e("）。",-1))]),t("li",null,[Q[81]||(Q[81]=e("算术强度高（",-1)),t("mjx-container",O,[(n(),s("svg",F,[...Q[79]||(Q[79]=[l("",1)])])),Q[80]||(Q[80]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",null,"≈"),t("mn",null,"2"),t("mo",null,"×"),t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[82]||(Q[82]=e("），与 MQA 相当但质量更好。",-1))]),Q[83]||(Q[83]=t("li",null,"并行友好：支持高效 TP 分片，避免 MLA 的缓存复制问题。",-1)),Q[84]||(Q[84]=t("li",null,"实验证明质量匹配 MLA（如 1.47B 模型，GLA-2 平均下游准确率 60.0% vs MLA 的 59.1%），且更容忍负载不均衡。",-1))])])]),Q[134]||(Q[134]=t("h2",{id:"小结",tabindex:"-1"},[e("小结 "),t("a",{class:"header-anchor",href:"#小结","aria-label":'Permalink to "小结"'},"​")],-1)),t("table",$,[Q[128]||(Q[128]=t("thead",null,[t("tr",null,[t("th",null,"方案"),t("th",null,"KV 缓存"),t("th",null,"算术强度"),t("th",null,"并行友好性"),t("th",null,"模型下游评测")])],-1)),t("tbody",null,[Q[127]||(Q[127]=t("tr",null,[t("td",null,"MHA"),t("td",null,"最大"),t("td",null,"低"),t("td",null,"TP 高效"),t("td",null,"49.65")],-1)),t("tr",null,[Q[91]||(Q[91]=t("td",null,"MQA",-1)),Q[92]||(Q[92]=t("td",null,"最小",-1)),t("td",null,[Q[89]||(Q[89]=e("高（≈",-1)),t("mjx-container",U,[(n(),s("svg",X,[...Q[87]||(Q[87]=[l("",1)])])),Q[88]||(Q[88]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[90]||(Q[90]=e("）",-1))]),Q[93]||(Q[93]=t("td",null,"TP 需复制全量 KV 缓存",-1)),Q[94]||(Q[94]=t("td",null,"49.18",-1))]),t("tr",null,[Q[99]||(Q[99]=t("td",null,"GQA",-1)),Q[100]||(Q[100]=t("td",null,"中等",-1)),t("td",null,[Q[97]||(Q[97]=e("中等（≈",-1)),t("mjx-container",W,[(n(),s("svg",Y,[...Q[95]||(Q[95]=[l("",1)])])),Q[96]||(Q[96]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[98]||(Q[98]=e("）",-1))]),Q[101]||(Q[101]=t("td",null,"TP 受限",-1)),Q[102]||(Q[102]=t("td",null,"48.27",-1))]),t("tr",null,[Q[107]||(Q[107]=t("td",null,"MLA",-1)),Q[108]||(Q[108]=t("td",null,"小",-1)),t("td",null,[Q[105]||(Q[105]=e("最高（≈",-1)),t("mjx-container",t1,[(n(),s("svg",Q1,[...Q[103]||(Q[103]=[l("",1)])])),Q[104]||(Q[104]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[106]||(Q[106]=e("）",-1))]),Q[109]||(Q[109]=t("td",null,"TP 需复制全量缓存",-1)),Q[110]||(Q[110]=t("td",null,"49.24",-1))]),t("tr",null,[Q[115]||(Q[115]=t("td",null,"GLA",-1)),Q[116]||(Q[116]=t("td",null,"小",-1)),t("td",null,[Q[113]||(Q[113]=e("最高（≈",-1)),t("mjx-container",e1,[(n(),s("svg",l1,[...Q[111]||(Q[111]=[l("",1)])])),Q[112]||(Q[112]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("msub",null,[t("mi",null,"h"),t("mi",null,"q")])])],-1))]),Q[114]||(Q[114]=e("）",-1))]),Q[117]||(Q[117]=t("td",null,"TP 受限",-1)),Q[118]||(Q[118]=t("td",null,"49.29",-1))]),t("tr",null,[Q[123]||(Q[123]=t("td",null,"GTA",-1)),Q[124]||(Q[124]=t("td",null,"小于 GQA",-1)),t("td",null,[Q[121]||(Q[121]=e("高（≈",-1)),t("mjx-container",s1,[(n(),s("svg",n1,[...Q[119]||(Q[119]=[l("",1)])])),Q[120]||(Q[120]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mn",null,"2"),t("msub",null,[t("mi",null,"g"),t("mi",null,"q")])])],-1))]),Q[122]||(Q[122]=e("）",-1))]),Q[125]||(Q[125]=t("td",null,"TP 受限",-1)),Q[126]||(Q[126]=t("td",null,"48.93",-1))])])]),Q[135]||(Q[135]=t("blockquote",null,[t("p",null,[t("strong",null,"注"),e("：下游评测为我们固定了模型的参数量、train token 量，在 lm-evaluation-harness 上得到的 average acc（由于只 train 了一组，所以实际可能略有浮动，仅作参考）。")])],-1))])}const u1=o(m,[["render",o1]]);export{p1 as __pageData,u1 as default};
