import{_ as s,c as e,a as t,q as a,N as T,o as l}from"./chunks/framework.BRsttz9t.js";const m="/assets/attention_sink_example_small.CqZYh014.png",o="/assets/attention_sink_fig_2.DmQG5cfc.png",n="/assets/attention_sink_fig_3.C9Ea9G0E.png",d="/assets/attention_sink_table_1.CoGQ6N1r.png",r="/assets/attention_sink_optimization.DCs-Dqat.png",i="/assets/attention_sink_fixed_position_small.CSsxvj66.png",h="/assets/attention_sink_norm_small.Bw87N39b.png",H="/assets/attention_sink_table_4.BlNx1ahl.png",p="/assets/attention_sink_model.CQ0kYR3K.png",g="/assets/attention_sink_lm_wo_sink_small._GeZRUOz.png",A1=JSON.parse('{"title":"【论文分享】｜Attention Sink 何时出现在语言模型中？","description":"","frontmatter":{"title":"【论文分享】｜Attention Sink 何时出现在语言模型中？","date":"2025-06-13T00:00:00.000Z","author":{"name":"娄司宇","github":"LLSGYN"},"category":"insights"},"headers":[],"relativePath":"posts/attnsink-paper-sharing.md","filePath":"posts/attnsink-paper-sharing.md"}'),u={name:"posts/attnsink-paper-sharing.md"},x={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.469ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.727ex",height:"4.07ex",role:"img",focusable:"false",viewBox:"0 -1149.5 9603.3 1799","aria-hidden":"true"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.669ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.291ex",height:"2.601ex",role:"img",focusable:"false",viewBox:"0 -853.7 1012.6 1149.4","aria-hidden":"true"},c={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.669ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.291ex",height:"2.601ex",role:"img",focusable:"false",viewBox:"0 -853.7 1012.6 1149.4","aria-hidden":"true"},f={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"37.082ex",height:"2.714ex",role:"img",focusable:"false",viewBox:"0 -902.3 16390.3 1199.6","aria-hidden":"true"},y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.765ex"},xmlns:"http://www.w3.org/2000/svg",width:"42.816ex",height:"2.806ex",role:"img",focusable:"false",viewBox:"0 -902.3 18924.9 1240.5","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.669ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.291ex",height:"2.601ex",role:"img",focusable:"false",viewBox:"0 -853.7 1012.6 1149.4","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},j={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.662ex",height:"1.91ex",role:"img",focusable:"false",viewBox:"0 -694 734.6 844","aria-hidden":"true"},_={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.093ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.113ex",height:"3.024ex",role:"img",focusable:"false",viewBox:"0 -853.7 1817.9 1336.8","aria-hidden":"true"},R={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.339ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.662ex",height:"1.91ex",role:"img",focusable:"false",viewBox:"0 -694 734.6 844","aria-hidden":"true"},C={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.437ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.993ex",height:"2.011ex",role:"img",focusable:"false",viewBox:"0 -696 1765 889","aria-hidden":"true"},E={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},P={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.817ex",height:"1.441ex",role:"img",focusable:"false",viewBox:"0 -626 361 637","aria-hidden":"true"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.673ex",height:"3.376ex",role:"img",focusable:"false",viewBox:"0 -1195.1 3391.4 1492.4","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.097ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.534ex",height:"3.8ex",role:"img",focusable:"false",viewBox:"0 -1195.1 3771.8 1679.8","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.991ex"},xmlns:"http://www.w3.org/2000/svg",width:"35.06ex",height:"3.46ex",role:"img",focusable:"false",viewBox:"0 -1091.5 15496.5 1529.5","aria-hidden":"true"},z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"12.555ex",height:"2.893ex",role:"img",focusable:"false",viewBox:"0 -981.5 5549.3 1278.8","aria-hidden":"true"},F={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"12.189ex",height:"2.893ex",role:"img",focusable:"false",viewBox:"0 -981.5 5387.5 1278.8","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.209ex",height:"2.893ex",role:"img",focusable:"false",viewBox:"0 -981.5 1418.6 1278.8","aria-hidden":"true"},Y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},U={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.626ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.186ex",height:"2.847ex",role:"img",focusable:"false",viewBox:"0 -981.5 1408.3 1258.3","aria-hidden":"true"},t1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.028ex"},xmlns:"http://www.w3.org/2000/svg",width:"22.698ex",height:"3.248ex",role:"img",focusable:"false",viewBox:"0 -981.5 10032.6 1435.8","aria-hidden":"true"},T1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},a1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.919ex",height:"1ex",role:"img",focusable:"false",viewBox:"0 -431 406 442","aria-hidden":"true"},e1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},l1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.673ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.414ex",height:"2.893ex",role:"img",focusable:"false",viewBox:"0 -981.5 3277.1 1278.8","aria-hidden":"true"},s1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},m1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.781ex"},xmlns:"http://www.w3.org/2000/svg",width:"35.712ex",height:"3.001ex",role:"img",focusable:"false",viewBox:"0 -981.5 15784.6 1326.5","aria-hidden":"true"},o1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.103ex",height:"1.439ex",role:"img",focusable:"false",viewBox:"0 -442 2697.4 636","aria-hidden":"true"},d1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},r1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.791ex"},xmlns:"http://www.w3.org/2000/svg",width:"66.716ex",height:"2.722ex",role:"img",focusable:"false",viewBox:"0 -853.7 29488.5 1203.2","aria-hidden":"true"},i1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},h1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.791ex"},xmlns:"http://www.w3.org/2000/svg",width:"73.655ex",height:"2.722ex",role:"img",focusable:"false",viewBox:"0 -853.7 32555.5 1203.2","aria-hidden":"true"},H1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},p1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.522ex",height:"2.117ex",role:"img",focusable:"false",viewBox:"0 -853.7 3766.7 935.7","aria-hidden":"true"},g1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},u1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.469ex"},xmlns:"http://www.w3.org/2000/svg",width:"87.94ex",height:"4.518ex",role:"img",focusable:"false",viewBox:"0 -1347.5 38869.7 1997","aria-hidden":"true"},x1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.469ex"},xmlns:"http://www.w3.org/2000/svg",width:"30.204ex",height:"4.07ex",role:"img",focusable:"false",viewBox:"0 -1149.5 13350.2 1799","aria-hidden":"true"},L1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.738ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1652 1000","aria-hidden":"true"},c1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.738ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 1652 1000","aria-hidden":"true"},f1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.429ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 3283.7 1000","aria-hidden":"true"};function y1(Z1,Q,D1,b1,v1,j1){return l(),e("div",null,[Q[113]||(Q[113]=t("p",null,[T("论文链接："),t("strong",null,[T("[ICLR 2025] "),t("a",{href:"https://arxiv.org/abs/2410.10781",target:"_blank",rel:"noreferrer"},"WHEN ATTENTION SINK EMERGES IN LANGUAGE MODELS: AN EMPIRICAL VIEW")])],-1)),Q[114]||(Q[114]=t("p",null,[T("Github 仓库："),t("a",{href:"https://github.com/sail-sg/Attention-Sink",target:"_blank",rel:"noreferrer"},"https://github.com/sail-sg/Attention-Sink")],-1)),Q[115]||(Q[115]=t("h2",{id:"什么是-attention-sink",tabindex:"-1"},[T("什么是 Attention Sink？ "),t("a",{class:"header-anchor",href:"#什么是-attention-sink","aria-label":'Permalink to "什么是 Attention Sink？"'},"​")],-1)),t("p",null,[Q[2]||(Q[2]=T("在 LLM 计算时，经常会为一些特定的 token 位置分配非常高的 attention score，从而在这些 token 位置形成垂直的 attention pattern。最常见的位置就是首 token，可以形式化表达为",-1)),t("mjx-container",x,[(l(),e("svg",V,[...Q[0]||(Q[0]=[a("",1)])])),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"A")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"i"),t("mo",null,","),t("mn",null,"1")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,"≫"),t("mtext",null,"mean"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msubsup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"A")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"i"),t("mo",null,","),t("mi",null,"j"),t("mo",null,"≠"),t("mn",null,"1")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),Q[3]||(Q[3]=T("。",-1))]),Q[116]||(Q[116]=a("",5)),t("p",null,[Q[6]||(Q[6]=T("因此",-1)),t("mjx-container",L,[(l(),e("svg",w,[...Q[4]||(Q[4]=[a("",1)])])),Q[5]||(Q[5]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mi",null,"l")])])],-1))]),Q[7]||(Q[7]=T("以及相应的 Q、K、V 可以视为直接从 word embedding 得到的 MLP 输出。",-1))]),t("ul",null,[t("li",null,[t("p",null,[Q[10]||(Q[10]=T("计算特性：",-1)),t("mjx-container",c,[(l(),e("svg",k,[...Q[8]||(Q[8]=[a("",1)])])),Q[9]||(Q[9]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mi",null,"l")])])],-1))]),Q[11]||(Q[11]=T("以及相应的 Q、K、V 可以视为直接从 word embedding 得到的 MLP 输出。",-1))]),t("ul",null,[t("li",null,[Q[16]||(Q[16]=T("首 token 和其他后续的 token 计算有一个显著不同：第一个 hidden state 的计算不涉及 self-attention",-1)),t("mjx-container",f,[(l(),e("svg",M,[...Q[12]||(Q[12]=[a("",1)])])),Q[13]||(Q[13]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"FFN"),t("mo",{stretchy:"false"},"("),t("mtext",null,"LN"),t("mo",{stretchy:"false"},"("),t("msubsup",null,[t("mi",null,"o"),t("mn",null,"1"),t("mi",null,"l")]),t("mo",null,"+"),t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("mo",null,"+"),t("msubsup",null,[t("mi",null,"o"),t("mn",null,"1"),t("mi",null,"l")]),t("mo",null,"+"),t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])])])],-1))]),Q[17]||(Q[17]=T("，",-1)),t("mjx-container",y,[(l(),e("svg",Z,[...Q[14]||(Q[14]=[a("",1)])])),Q[15]||(Q[15]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"o"),t("mn",null,"1"),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"LN"),t("mo",{stretchy:"false"},"("),t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},"["),t("msup",null,[t("mi",null,"W"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mn",null,"1")])]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("msup",null,[t("mi",null,"W"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mn",null,"2")])]),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("mo",null,"…"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"1em"})]),t("msup",null,[t("mi",null,"W"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"H")])]),t("mo",{stretchy:"false"},"]"),t("msubsup",null,[t("mi",null,"W"),t("mi",null,"O"),t("mi",null,"l")])])],-1))]),Q[18]||(Q[18]=T("。",-1))])])]),t("li",null,[t("p",null,[Q[25]||(Q[25]=T("数值特性：从特定层开始，",-1)),t("mjx-container",D,[(l(),e("svg",b,[...Q[19]||(Q[19]=[a("",1)])])),Q[20]||(Q[20]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"h"),t("mn",null,"1"),t("mi",null,"l")])])],-1))]),Q[26]||(Q[26]=T("的",-1)),t("mjx-container",v,[(l(),e("svg",j,[...Q[21]||(Q[21]=[a("",1)])])),Q[22]||(Q[22]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{"data-mjx-variant":"-tex-calligraphic",mathvariant:"script"},"l")]),t("mn",null,"2")])])],-1))]),Q[27]||(Q[27]=T("范数会显著大于其他 token ",-1)),t("mjx-container",_,[(l(),e("svg",A,[...Q[23]||(Q[23]=[a("",1)])])),Q[24]||(Q[24]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"h"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"t"),t("mo",null,"≠"),t("mn",null,"1")]),t("mi",null,"l")])])],-1))]),Q[28]||(Q[28]=T("。",-1))])]),t("li",null,[t("p",null,[Q[31]||(Q[31]=T("key, value 数值：第一个 token 的 key/value ",-1)),t("mjx-container",R,[(l(),e("svg",O,[...Q[29]||(Q[29]=[a("",1)])])),Q[30]||(Q[30]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{"data-mjx-variant":"-tex-calligraphic",mathvariant:"script"},"l")]),t("mn",null,"2")])])],-1))]),Q[32]||(Q[32]=T("范数显著小于同一图中其他 token 的对应值。",-1))])])]),Q[117]||(Q[117]=t("p",null,[t("img",{src:o,alt:""})],-1)),t("p",null,[t("strong",null,[t("mjx-container",C,[(l(),e("svg",S,[...Q[33]||(Q[33]=[a("",1)])])),Q[34]||(Q[34]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"QK")])])],-1))]),Q[35]||(Q[35]=T("的角度促进了 attention sink",-1))])]),t("p",null,[Q[42]||(Q[42]=T("对于第",-1)),t("mjx-container",E,[(l(),e("svg",P,[...Q[36]||(Q[36]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D461",d:"M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[37]||(Q[37]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"t")])],-1))]),Q[43]||(Q[43]=T("个 query，",-1)),t("mjx-container",N,[(l(),e("svg",X,[...Q[38]||(Q[38]=[a("",1)])])),Q[39]||(Q[39]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("msubsup",null,[t("mi",null,"k"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"sans-serif"},"T")])])])])],-1))]),Q[44]||(Q[44]=T("通常比",-1)),t("mjx-container",I,[(l(),e("svg",B,[...Q[40]||(Q[40]=[a("",1)])])),Q[41]||(Q[41]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("msubsup",null,[t("mi",null,"k"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"j"),t("mo",null,"≠"),t("mn",null,"1")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"sans-serif"},"T")])])])])],-1))]),Q[45]||(Q[45]=T("具有更大的值，考察促成这一现象的原因。注意到，qk 内积可以表示为：",-1))]),t("p",null,[t("mjx-container",G,[(l(),e("svg",q,[...Q[46]||(Q[46]=[a("",1)])])),Q[47]||(Q[47]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("msubsup",null,[t("mi",null,"k"),t("mi",null,"j"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("msup",null,[t("mi",null,"h"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"sans-serif"},"T")])])])])]),t("mo",null,"="),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("msubsup",null,[t("mi",null,"k"),t("mi",null,"j"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("mo",null,"⋅"),t("mi",null,"cos"),t("mo",{"data-mjx-texclass":"NONE"},"⁡"),t("mo",{stretchy:"false"},"("),t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,","),t("msubsup",null,[t("mi",null,"k"),t("mi",null,"j"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{stretchy:"false"},")")])],-1))])]),Q[118]||(Q[118]=t("p",null,"从 Fig2 的结果可以发现：",-1)),t("ul",null,[t("li",null,[Q[50]||(Q[50]=T("l2 范数的乘积",-1)),t("mjx-container",z,[(l(),e("svg",J,[...Q[48]||(Q[48]=[a("",1)])])),Q[49]||(Q[49]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("mo",null,"⋅"),t("mo",{"data-mjx-texclass":"ORD"},"∥"),t("msubsup",null,[t("mi",null,"k"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"ORD"},"∥")])],-1))]),Q[51]||(Q[51]=T("较小。",-1))]),t("li",null,[Q[54]||(Q[54]=T("角度项",-1)),t("mjx-container",F,[(l(),e("svg",K,[...Q[52]||(Q[52]=[a("",1)])])),Q[53]||(Q[53]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"cos"),t("mo",{"data-mjx-texclass":"NONE"},"⁡"),t("mo",{stretchy:"false"},"("),t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,","),t("msubsup",null,[t("mi",null,"k"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",{stretchy:"false"},")")])],-1))]),Q[55]||(Q[55]=T("非常大，导致了 attention sink。",-1))])]),t("p",null,[Q[60]||(Q[60]=T("第一个词符利用其 key 作为偏置（bias），从而最小化",-1)),t("mjx-container",W,[(l(),e("svg",$,[...Q[56]||(Q[56]=[a("",1)])])),Q[57]||(Q[57]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"k"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])])])],-1))]),Q[61]||(Q[61]=T("和",-1)),t("mjx-container",Y,[(l(),e("svg",U,[...Q[58]||(Q[58]=[a("",1)])])),Q[59]||(Q[59]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"q"),t("mi",null,"t"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])])])],-1))]),Q[62]||(Q[62]=T("之间的角度，并表现出 attention sink。",-1))]),Q[119]||(Q[119]=t("h3",{id:"二、attention-sink-的测量方法",tabindex:"-1"},[T("二、Attention Sink 的测量方法 "),t("a",{class:"header-anchor",href:"#二、attention-sink-的测量方法","aria-label":'Permalink to "二、Attention Sink 的测量方法"'},"​")],-1)),Q[120]||(Q[120]=t("ul",null,[t("li",null,"基于可视化的方法：绘制出 num_head * num_layers 个图像，难以处理。"),t("li",null,"设计一个观测 attention head 的评估指标。")],-1)),Q[121]||(Q[121]=t("p",null,"计算 k-th token 的重要性分数：",-1)),t("p",null,[t("mjx-container",t1,[(l(),e("svg",Q1,[...Q[63]||(Q[63]=[a("",1)])])),Q[64]||(Q[64]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"α"),t("mi",null,"k"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,"="),t("mfrac",null,[t("mn",null,"1"),t("mrow",null,[t("mi",null,"T"),t("mo",null,"−"),t("mi",null,"k"),t("mo",null,"+"),t("mn",null,"1")])]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"i"),t("mo",null,"="),t("mi",null,"k")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"T")])]),t("msubsup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"A")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"i"),t("mo",null,","),t("mi",null,"k")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])])])],-1))])]),t("p",null,[Q[69]||(Q[69]=T("首先考虑首 token 的情况。给定阈值",-1)),t("mjx-container",T1,[(l(),e("svg",a1,[...Q[65]||(Q[65]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D716",d:"M227 -11Q149 -11 95 41T40 174Q40 262 87 322Q121 367 173 396T287 430Q289 431 329 431H367Q382 426 382 411Q382 385 341 385H325H312Q191 385 154 277L150 265H327Q340 256 340 246Q340 228 320 219H138V217Q128 187 128 143Q128 77 160 52T231 26Q258 26 284 36T326 57T343 68Q350 68 354 58T358 39Q358 36 357 35Q354 31 337 21T289 0T227 -11Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[66]||(Q[66]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"ϵ")])],-1))]),Q[70]||(Q[70]=T("，称一个 head 中存在 attention sink 如果首 token 的重要性分数",-1)),t("mjx-container",e1,[(l(),e("svg",l1,[...Q[67]||(Q[67]=[a("",1)])])),Q[68]||(Q[68]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"α"),t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,">"),t("mi",null,"ϵ")])],-1))]),Q[71]||(Q[71]=T("。",-1))]),Q[122]||(Q[122]=t("p",null,"计算 LM 的 attention sink 情况：",-1)),t("p",null,[t("mjx-container",s1,[(l(),e("svg",m1,[...Q[72]||(Q[72]=[a("",1)])])),Q[73]||(Q[73]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mtext",null,"Sink"),t("mi",null,"k"),t("mi",null,"ϵ")]),t("mo",null,"="),t("mfrac",null,[t("mn",null,"1"),t("mi",null,"L")]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"="),t("mn",null,"1")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"L")])]),t("mfrac",null,[t("mn",null,"1"),t("mi",null,"H")]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"h"),t("mo",null,"="),t("mn",null,"1")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"H")])]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"double-struck"},"I")]),t("mo",{stretchy:"false"},"("),t("msubsup",null,[t("mi",null,"α"),t("mi",null,"k"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,">"),t("mi",null,"ϵ"),t("mo",{stretchy:"false"},")"),t("mo",null,".")])],-1))])]),Q[123]||(Q[123]=a("",10)),t("ul",null,[Q[81]||(Q[81]=t("li",null,[T("当 LM 在"),t("strong",null,"充足的训练数据"),T("上得到有效训练后，attention sink 开始显现 。")],-1)),t("li",null,[Q[76]||(Q[76]=T("通过修改数据分布 ",-1)),t("mjx-container",o1,[(l(),e("svg",n1,[...Q[74]||(Q[74]=[a("",1)])])),Q[75]||(Q[75]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"p"),t("mtext",null,"DATA")])])],-1))]),Q[77]||(Q[77]=T("​，可以将 attention sink 的位置",-1)),Q[78]||(Q[78]=t("strong",null,"从第一个 token 转移到其他位置",-1)),Q[79]||(Q[79]=T("。 ",-1)),Q[80]||(Q[80]=t("ul",null,[t("li",null,"即使将第一个 token 随机重采样，attention sink 依然存在，甚至可能更明显 。"),t("li",null,"如果将输入序列的前几个 token 都进行随机重采样，sink token 的位置可能会发生改变 。")],-1))])]),Q[124]||(Q[124]=a("",8)),t("ul",null,[Q[91]||(Q[91]=t("li",null,[t("p",null,"位置编码的种类："),t("ul",null,[t("li",null,"测试了多种位置编码方式（包括无位置编码 NoPE、绝对位置编码、可学习位置编码、ALiBi 和 RoPE），结果显示，所有采用这些编码方式的语言模型，甚至那些没有明确位置编码的模型，都出现了 attention sink 。")])],-1)),t("li",null,[Q[90]||(Q[90]=t("p",null,"Pre-Norm vs Post-Norm",-1)),t("ul",null,[t("li",null,[Q[84]||(Q[84]=T("Pre-norm：",-1)),t("mjx-container",d1,[(l(),e("svg",r1,[...Q[82]||(Q[82]=[a("",1)])])),Q[83]||(Q[83]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"FFN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("mtext",null,"LN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"+"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",null,"+"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"+"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",null,","),t("mtext",null," "),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"MHSA"),t("mo",{stretchy:"false"},"("),t("mtext",null,"LN"),t("mo",{stretchy:"false"},"("),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")")])],-1))])]),t("li",null,[Q[87]||(Q[87]=T("Post-norm：",-1)),t("mjx-container",i1,[(l(),e("svg",h1,[...Q[85]||(Q[85]=[a("",1)])])),Q[86]||(Q[86]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"LN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("mtext",null,"FFN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("mtext",null,"LN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"+"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",null,"+"),t("mtext",null,"LN"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"+"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mo",null,","),t("mtext",null," "),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"O")]),t("mi",null,"l")]),t("mo",null,"="),t("mtext",null,"MHSA"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"H")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"l"),t("mo",null,"−"),t("mn",null,"1")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))])]),Q[88]||(Q[88]=t("li",null,"Pre-norm 结构中，hidden state 的数值可以由 residual connection 在层间传播。一层出现了 massive value 后，后面的层也很有可能保留。",-1)),Q[89]||(Q[89]=t("li",null,"无论是 pre-norm 还是 post-norm，attention sink 都会存在。Post-norm 的 massive value 出现在了 Post-LN 之前。",-1))])])]),Q[125]||(Q[125]=t("p",null,[t("img",{src:h,alt:""})],-1)),Q[126]||(Q[126]=t("ul",null,[t("li",null,"Attention sink 更像是一种“key bias”")],-1)),Q[127]||(Q[127]=t("p",null,[t("img",{src:H,alt:""})],-1)),t("p",null,[Q[94]||(Q[94]=T("通过引入可学习的 sink token（作为 implicit bias）或直接在注意力机制中添加可学习的键值偏置 (KV biases) 或仅键偏置 (K biases, 此时",-1)),t("mjx-container",H1,[(l(),e("svg",p1,[...Q[92]||(Q[92]=[a("",1)])])),Q[93]||(Q[93]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"v")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"⋆"),t("mi",null,"l"),t("mo",null,","),t("mi",null,"h")])]),t("mo",null,"="),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",{mathvariant:"bold"},"0")])])],-1))]),Q[95]||(Q[95]=T(")，可以将 sink token 从第一个 token 转移到这些引入的 bias 上，且不会损害模型性能 。而仅使用 value bias 则做不到，sink 会回到第一个 token。",-1))]),Q[128]||(Q[128]=t("h2",{id:"attention-形式的影响",tabindex:"-1"},[T("Attention 形式的影响 "),t("a",{class:"header-anchor",href:"#attention-形式的影响","aria-label":'Permalink to "Attention 形式的影响"'},"​")],-1)),Q[129]||(Q[129]=t("p",null,[t("strong",null,"Attention 的一般形式：")],-1)),t("p",null,[t("mjx-container",g1,[(l(),e("svg",u1,[...Q[96]||(Q[96]=[a("",1)])])),Q[97]||(Q[97]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msubsup",null,[t("mi",null,"v"),t("mi",null,"i"),t("mo",null,"†")]),t("mo",null,"="),t("msup",null,[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("msup",null,[t("mi",null,"j"),t("mo",{"data-mjx-alternate":"1"},"′")]),t("mo",null,"="),t("mn",null,"1")]),t("mi",null,"i")]),t("mtext",null,"sim"),t("mo",{stretchy:"false"},"("),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"q"),t("mi",null,"i")]),t("mo",{stretchy:"false"},")"),t("mo",null,","),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"k"),t("mrow",{"data-mjx-texclass":"ORD"},[t("msup",null,[t("mi",null,"j"),t("mo",{"data-mjx-alternate":"1"},"′")])])]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"1")])]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"j"),t("mo",null,"="),t("mn",null,"1")]),t("mi",null,"i")]),t("mtext",null,"sim"),t("mo",{stretchy:"false"},"("),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"q"),t("mi",null,"i")]),t("mo",{stretchy:"false"},")"),t("mo",null,","),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"k"),t("mi",null,"j")]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("msub",null,[t("mi",null,"v"),t("mi",null,"j")]),t("mo",null,"="),t("msubsup",null,[t("mi",null,"Z"),t("mi",null,"i"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"−"),t("mn",null,"1")])]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"j"),t("mo",null,"="),t("mn",null,"1")]),t("mi",null,"i")]),t("mtext",null,"sim"),t("mo",{stretchy:"false"},"("),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"q"),t("mi",null,"i")]),t("mo",{stretchy:"false"},")"),t("mo",null,","),t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mi",null,"k"),t("mi",null,"j")]),t("mo",{stretchy:"false"},")"),t("mo",{stretchy:"false"},")"),t("msub",null,[t("mi",null,"v"),t("mi",null,"j")])])],-1))])]),t("p",null,[Q[102]||(Q[102]=T("对于 Softmax-attention，",-1)),t("mjx-container",x1,[(l(),e("svg",V1,[...Q[98]||(Q[98]=[a("",1)])])),Q[99]||(Q[99]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mtext",null,"sim"),t("mo",{stretchy:"false"},"("),t("msub",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"q")]),t("mi",null,"i")]),t("mo",null,","),t("msub",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"k")]),t("mi",null,"j")]),t("mo",{stretchy:"false"},")"),t("mo",null,"="),t("mi",null,"exp"),t("mo",{"data-mjx-texclass":"NONE"},"⁡"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("msub",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"q")]),t("mi",null,"i")]),t("msubsup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"bold"},"k")]),t("mi",null,"j"),t("mi",null,"T")]),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msqrt",null,[t("msub",null,[t("mi",null,"d"),t("mi",null,"h")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")])])],-1))]),Q[103]||(Q[103]=T(",",-1)),t("mjx-container",L1,[(l(),e("svg",w1,[...Q[100]||(Q[100]=[a("",1)])])),Q[101]||(Q[101]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("mo",null,"⋅"),t("mo",{stretchy:"false"},")")])],-1))]),Q[104]||(Q[104]=T("是 identity kernel。",-1))]),Q[130]||(Q[130]=t("p",null,"设计空间：",-1)),t("ul",null,[t("li",null,[Q[107]||(Q[107]=T("kernel function ",-1)),t("mjx-container",c1,[(l(),e("svg",k1,[...Q[105]||(Q[105]=[a("",1)])])),Q[106]||(Q[106]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"ϕ"),t("mo",{stretchy:"false"},"("),t("mo",null,"⋅"),t("mo",{stretchy:"false"},")")])],-1))]),Q[108]||(Q[108]=T("：elu plus one; identity; MLP;",-1))]),t("li",null,[Q[111]||(Q[111]=T("相似度函数",-1)),t("mjx-container",f1,[(l(),e("svg",M1,[...Q[109]||(Q[109]=[a("",1)])])),Q[110]||(Q[110]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mtext",null,"sim"),t("mo",{stretchy:"false"},"("),t("mo",null,"⋅"),t("mo",null,","),t("mo",null,"⋅"),t("mo",{stretchy:"false"},")")])],-1))])]),Q[112]||(Q[112]=t("li",null,"是否使用归一化项",-1))]),Q[131]||(Q[131]=a("",10))])}const R1=s(u,[["render",y1]]);export{A1 as __pageData,R1 as default};
