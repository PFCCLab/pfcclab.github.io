import{_ as s,c as T,q as e,a as t,N as a,o as n}from"./chunks/framework.BRsttz9t.js";const l="/assets/ring-attention-principle-diagram.DcC1Mu3j.png",o="/assets/megatron-LM-load-balance-diagram1.CByzuXhb.png",r="/assets/megatron-LM-load-balance-diagram2._Loauq7e.png",i="/assets/striped-attention-load-balance-diagram.SUNT2cW5.png",m="/assets/disattention-load-balance-diagram.ezNGsHsu.png",d="/assets/ring-attention-communication-diagram.DWlQjD-O.png",p="/assets/attention2d-principle-diagram.DU55qH3G.png",h="/assets/attention2d-no-overlap-algorithm-diagram1.JWMGf8rC.png",g="/assets/attention2d-no-overlap-algorithm-diagram2.DAfZFTJE.png",u="/assets/attention2d-no-overlap-algorithm-diagram3.Dqk1y78m.png",x="/assets/attention2d-overlap-algorithm-diagram1.ayxdoRyz.png",c="/assets/attention2d-overlap-algorithm-diagram2.BQtUtr-O.png",w="/assets/attention2d-overlap-algorithm-diagram3.BcutvMKz.png",f="/assets/attention2d-experiment-result1.CEa4QZ9P.png",H="/assets/attention2d-experiment-result2.Cu8A7akd.png",L="/assets/ulysses-principle-diagram.C0y8atbj.png",y="/assets/usp-algorithm-diagram1.B8Bd8pNz.png",_="/assets/usp-algorithm-diagram2.B5LIktzF.png",k="/assets/different-parallel-strategy-communication-diagram.AqTSS1Sw.png",M="/assets/usp-experiment-result.C4Ry4RFA.png",p3=JSON.parse('{"title":"【论文分享】｜ 大模型训练中的序列并行技术与优化策略","description":"","frontmatter":{"title":"【论文分享】｜ 大模型训练中的序列并行技术与优化策略","date":"2025-07-21T00:00:00.000Z","author":{"name":"谢浩阳","github":"starcrown001"},"category":"insights"},"headers":[],"relativePath":"posts/context-parrel-sharing.md","filePath":"posts/context-parrel-sharing.md"}'),v={name:"posts/context-parrel-sharing.md"},b={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.798ex"},xmlns:"http://www.w3.org/2000/svg",width:"34.919ex",height:"3.024ex",role:"img",focusable:"false",viewBox:"0 -983.7 15434 1336.5","aria-hidden":"true"},D={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"9.494ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 4196.4 1000","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.206ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.629ex",height:"2.398ex",role:"img",focusable:"false",viewBox:"0 -969 1604 1060","aria-hidden":"true"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.206ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.629ex",height:"2.398ex",role:"img",focusable:"false",viewBox:"0 -969 1604 1060","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},R={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.6ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 5127 1000","aria-hidden":"true"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.36ex",height:"2.758ex",role:"img",focusable:"false",viewBox:"0 -969 7231 1219","aria-hidden":"true"},I={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.74ex",height:"2.26ex",role:"img",focusable:"false",viewBox:"0 -704 1211.3 999","aria-hidden":"true"},X={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.872ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 1269.3 978","aria-hidden":"true"},B={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.27ex",height:"2.213ex",role:"img",focusable:"false",viewBox:"0 -683 1003.3 978","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},J={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.385ex",height:"2.758ex",role:"img",focusable:"false",viewBox:"0 -969 5032 1219","aria-hidden":"true"},F={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},K={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.65ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.782ex",height:"2.242ex",role:"img",focusable:"false",viewBox:"0 -704 1229.7 991.2","aria-hidden":"true"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},W={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.335ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 4568 1000","aria-hidden":"true"},$={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"29.232ex",height:"2.758ex",role:"img",focusable:"false",viewBox:"0 -969 12920.4 1219","aria-hidden":"true"},t3={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Q3={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.206ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.565ex",height:"2.398ex",role:"img",focusable:"false",viewBox:"0 -969 4669.6 1060","aria-hidden":"true"},a3={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e3={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"15.971ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 7059 1000","aria-hidden":"true"},T3={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},n3={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.639ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 5144.4 1000","aria-hidden":"true"};function s3(l3,Q,o3,r3,i3,m3){return n(),T("div",null,[Q[52]||(Q[52]=e("",16)),t("p",null,[Q[4]||(Q[4]=a("初始版本的 ring-attention 的单卡通信量，参考下图所示，为 ",-1)),t("mjx-container",b,[(n(),T("svg",Z,[...Q[0]||(Q[0]=[e("",1)])])),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mrow",{"data-mjx-texclass":"OPEN"},[t("mo",{minsize:"1.2em",maxsize:"1.2em"},"(")]),t("mi",null,"N"),t("mo",null,"⋅"),t("mi",null,"h"),t("mi",null,"s"),t("mo",null,"⋅"),t("mstyle",{displaystyle:"false",scriptlevel:"0"},[t("mfrac",null,[t("mrow",null,[t("mi",null,"P"),t("mo",null,"−"),t("mn",null,"1")]),t("mi",null,"P")])]),t("mo",null,"⋅"),t("mstyle",{displaystyle:"false",scriptlevel:"0"},[t("mfrac",null,[t("mi",null,"N"),t("mi",null,"P")])]),t("mo",null,"⋅"),t("mstyle",{displaystyle:"false",scriptlevel:"0"},[t("mfrac",null,[t("mn",null,"1"),t("mi",null,"c")])]),t("mrow",{"data-mjx-texclass":"CLOSE"},[t("mo",{minsize:"1.2em",maxsize:"1.2em"},")")]),t("mo",null,"="),t("mi",null,"O"),t("mstyle",{scriptlevel:"0"},[t("mspace",{width:"-0.167em"})]),t("mrow",{"data-mjx-texclass":"OPEN"},[t("mo",{minsize:"1.2em",maxsize:"1.2em"},"(")]),t("mstyle",{displaystyle:"false",scriptlevel:"0"},[t("mfrac",null,[t("mrow",null,[t("msup",null,[t("mi",null,"N"),t("mn",null,"2")]),t("mo",null,"⋅"),t("mi",null,"h"),t("mi",null,"s")]),t("mrow",null,[t("mi",null,"P"),t("mo",null,"⋅"),t("mi",null,"c")])])]),t("mrow",{"data-mjx-texclass":"CLOSE"},[t("mo",{minsize:"1.2em",maxsize:"1.2em"},")")])])],-1))]),Q[5]||(Q[5]=a("（hs 为 head size，N 为 seqlen，P 为设备数量，c 为 ring-attention 中的分块大小），其在每次外层迭代中都会重新 load 一遍完整的 K 、V 矩阵，引入了大量通信开销。而在 llama3 [9] 与 megatron 的部分实现中，每个设备在进行分块计算前都会对 K 、V 进行一次 all gather 操作一次性获取本设备所需的完整 K 、V 矩阵，以额外的内存开销与舍弃了计算通信 overlap 的代价降低了通信量，此时的单卡通信量为 ",-1)),t("mjx-container",D,[(n(),T("svg",S,[...Q[2]||(Q[2]=[e("",1)])])),Q[3]||(Q[3]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"N"),t("mo",null,"⋅"),t("mi",null,"h"),t("mi",null,"s"),t("mo",{stretchy:"false"},")")])],-1))]),Q[6]||(Q[6]=a("。ring-attention 通信量示意图见下。",-1))]),Q[53]||(Q[53]=t("p",null,[t("img",{src:d,alt:"ring-attention 通信量示意图",title:"ring-attention 通信量示意图"})],-1)),Q[54]||(Q[54]=t("h3",{id:"_2-3-attention2d",tabindex:"-1"},[a("2.3 attention2D "),t("a",{class:"header-anchor",href:"#_2-3-attention2d","aria-label":'Permalink to "2.3 attention2D"'},"​")],-1)),t("p",null,[Q[11]||(Q[11]=a("在 ring-attention 中，由于只在 Q 维度上进行了并行，因此每个设备需要通信的 K/V 矩阵通信量并不会随着设备数的增加而减少。 为了解决这个问题，微软在 2025 年提出了 Attention2D[10]，其在 kv 维度上同样进行了切分与并行。给定 P 个设备，Attention2D 会把 attention 的处理过程划分为",-1)),t("mjx-container",P,[(n(),T("svg",A,[...Q[7]||(Q[7]=[e("",1)])])),Q[8]||(Q[8]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msqrt",null,[t("mi",null,"P")])])],-1))]),Q[12]||(Q[12]=a("* ",-1)),t("mjx-container",V,[(n(),T("svg",C,[...Q[9]||(Q[9]=[e("",1)])])),Q[10]||(Q[10]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msqrt",null,[t("mi",null,"P")])])],-1))]),Q[13]||(Q[13]=a(" 的 grid 进行并行计算，由于同时在 kv 维度与 q 维度上进行了等分，该算法本身就带有负载均衡的特性。Attention2D 的原理示意图见下",-1))]),Q[55]||(Q[55]=e("",9)),t("p",null,[Q[36]||(Q[36]=a("与 ring-attention 相比，attention2D 的方法虽然额外引入了 Q 矩阵的通信开销，但却在单层 attention 计算中把矩阵的通信开销的复杂度从 ",-1)),t("mjx-container",j,[(n(),T("svg",R,[...Q[14]||(Q[14]=[e("",1)])])),Q[15]||(Q[15]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"B"),t("mi",null,"N"),t("mi",null,"M"),t("mi",null,"H"),t("mo",{stretchy:"false"},")")])],-1))]),Q[37]||(Q[37]=a(" 降低为了 ",-1)),t("mjx-container",N,[(n(),T("svg",O,[...Q[16]||(Q[16]=[e("",1)])])),Q[17]||(Q[17]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"B"),t("mi",null,"N"),t("mi",null,"M"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msqrt",null,[t("mi",null,"P")]),t("mo",{stretchy:"false"},")")])],-1))]),Q[38]||(Q[38]=a("（B 为 batchsize，N 为序列长度，M 为头数，H 为 headdim，P 为设备数）。下面对内存复杂度进行讨论。在上文提到的 attention2D 的算法中，在前向计算时每个设备的单层网络的单个头持有的 Q、K、V 矩阵块 ",-1)),t("mjx-container",I,[(n(),T("svg",E,[...Q[18]||(Q[18]=[e("",1)])])),Q[19]||(Q[19]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Q"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"g")])])])],-1))]),Q[39]||(Q[39]=a("、",-1)),t("mjx-container",X,[(n(),T("svg",z,[...Q[20]||(Q[20]=[e("",1)])])),Q[21]||(Q[21]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"K"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"g")])])])],-1))]),Q[40]||(Q[40]=a("、",-1)),t("mjx-container",B,[(n(),T("svg",q,[...Q[22]||(Q[22]=[e("",1)])])),Q[23]||(Q[23]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"V"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"g")])])])],-1))]),Q[41]||(Q[41]=a(" 占用内存的空间复杂度为 ",-1)),t("mjx-container",G,[(n(),T("svg",J,[...Q[24]||(Q[24]=[e("",1)])])),Q[25]||(Q[25]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"N"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msqrt",null,[t("mi",null,"P")])])],-1))]),Q[42]||(Q[42]=a(")。在一次 attention 计算完成后，当前设备在该层该头需要长期保有以供反向传播使用的矩阵块如 ",-1)),t("mjx-container",F,[(n(),T("svg",K,[...Q[26]||(Q[26]=[e("",1)])])),Q[27]||(Q[27]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"Q"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"p")])])])],-1))]),Q[43]||(Q[43]=a(" 的空间复杂度为 ",-1)),t("mjx-container",U,[(n(),T("svg",W,[...Q[28]||(Q[28]=[e("",1)])])),Q[29]||(Q[29]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"N"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("mi",null,"P"),t("mo",{stretchy:"false"},")")])],-1))]),Q[44]||(Q[44]=a(" 。因此在整个模型训练过程中，峰值显存占用为单次计算占用与长期保有矩阵显存占用之和，其复杂度为 ",-1)),t("mjx-container",$,[(n(),T("svg",Y,[...Q[30]||(Q[30]=[e("",1)])])),Q[31]||(Q[31]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"B"),t("mi",null,"L"),t("mi",null,"M"),t("mi",null,"N"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("mi",null,"P"),t("mo",null,"+"),t("mi",null,"B"),t("mi",null,"N"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msqrt",null,[t("mi",null,"P")]),t("mo",{stretchy:"false"},")")])],-1))]),Q[45]||(Q[45]=a("（L 为层数）。当 ",-1)),t("mjx-container",t3,[(n(),T("svg",Q3,[...Q[32]||(Q[32]=[e("",1)])])),Q[33]||(Q[33]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"L"),t("mi",null,"M"),t("mo",null,">"),t("msqrt",null,[t("mi",null,"P")])])],-1))]),Q[46]||(Q[46]=a(" 的场合，其空间复杂度可简化为 ",-1)),t("mjx-container",a3,[(n(),T("svg",e3,[...Q[34]||(Q[34]=[e("",1)])])),Q[35]||(Q[35]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"B"),t("mi",null,"L"),t("mi",null,"M"),t("mi",null,"N"),t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("mi",null,"P"),t("mo",{stretchy:"false"},")")])],-1))]),Q[47]||(Q[47]=a(" ，与 ring-attention 相同。",-1))]),Q[56]||(Q[56]=e("",7)),t("p",null,[Q[50]||(Q[50]=a("ulysses 的单卡通信量相比优化后的 ring-attention 较少，为 ",-1)),t("mjx-container",T3,[(n(),T("svg",n3,[...Q[48]||(Q[48]=[e("",1)])])),Q[49]||(Q[49]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"O"),t("mo",{stretchy:"false"},"("),t("mi",null,"N"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("mi",null,"P"),t("mo",null,"∗"),t("mi",null,"d"),t("mo",{stretchy:"false"},")")])],-1))]),Q[51]||(Q[51]=a("，但 ring-attention 实现了通信与计算的 overlap 的操作。此外， ring-attention 需要多次 launch kernel，而 ulysses 只用 launch 一次 attention kernel，可以减少 kernel launch 的开销。但需要注意的是，ulysses 可以并行的最大维度为 head 数量，在并行程度上相较于 ring-attention 有所不足。",-1))]),Q[57]||(Q[57]=e("",23))])}const h3=s(v,[["render",s3]]);export{p3 as __pageData,h3 as default};
