import{_ as o,c as e,q as l,a as t,N as a,o as T}from"./chunks/framework.BRsttz9t.js";const s="/assets/kv-cache-sparse.XNn5J88I.png",n="/assets/streamllm.k1PiVbxt.png",r="/assets/h2o.D45h3oQg.png",i="/assets/snapkv-1.C4Q5n14O.png",d="/assets/snapkv-2.De-ZZVT7.png",m="/assets/cake-1.DRm2rlR-.png",p="/assets/cake-2.B29SWIqE.png",h="/assets/cake-3.Cpa-dvZV.png",h1=JSON.parse('{"title":"【论文分享】| 基于驱逐机制的 KV 缓存压缩技术在大模型推理中的应用","description":"","frontmatter":{"title":"【论文分享】| 基于驱逐机制的 KV 缓存压缩技术在大模型推理中的应用","date":"2025-07-09T00:00:00.000Z","author":{"name":"卢畅","github":"AndSonder"},"category":"insights"},"headers":[],"relativePath":"posts/kv-cache-drop-for-llm-infer.md","filePath":"posts/kv-cache-drop-for-llm-infer.md"}'),g={name:"posts/kv-cache-drop-for-llm-infer.md"},u={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},x={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.186ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.723ex",height:"2.32ex",role:"img",focusable:"false",viewBox:"0 -943.3 7391.8 1025.3","aria-hidden":"true"},w={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.674ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -694 298 705","aria-hidden":"true"},H={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"10.529ex",height:"2.261ex",role:"img",focusable:"false",viewBox:"0 -841.7 4654 999.5","aria-hidden":"true"},f={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},L={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.673ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2507.7 1000","aria-hidden":"true"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},y={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.781ex",height:"1.52ex",role:"img",focusable:"false",viewBox:"0 -661 345 672","aria-hidden":"true"},M={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},b={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.462ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.932ex",height:"1.957ex",role:"img",focusable:"false",viewBox:"0 -661 412 865","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.545ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1124.7 840.8","aria-hidden":"true"},_={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},D={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.37ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2373.7 1000","aria-hidden":"true"},C={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.025ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.781ex",height:"1.52ex",role:"img",focusable:"false",viewBox:"0 -661 345 672","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-3.006ex"},xmlns:"http://www.w3.org/2000/svg",width:"27.668ex",height:"5.155ex",role:"img",focusable:"false",viewBox:"0 -950 12229.3 2278.6","aria-hidden":"true"},P={start:"3"},K={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},B={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.545ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1124.7 840.8","aria-hidden":"true"},R={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},I={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.819ex"},xmlns:"http://www.w3.org/2000/svg",width:"14.791ex",height:"6.73ex",role:"img",focusable:"false",viewBox:"0 -1728.7 6537.6 2974.6","aria-hidden":"true"},E={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},O={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.984ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 876.7 840.8","aria-hidden":"true"},N={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},X={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.566ex"},xmlns:"http://www.w3.org/2000/svg",width:"5.522ex",height:"2.262ex",role:"img",focusable:"false",viewBox:"0 -750 2440.7 1000","aria-hidden":"true"},J={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},q={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.462ex"},xmlns:"http://www.w3.org/2000/svg",width:"0.932ex",height:"1.957ex",role:"img",focusable:"false",viewBox:"0 -661 412 865","aria-hidden":"true"},G={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.666ex"},xmlns:"http://www.w3.org/2000/svg",width:"16.18ex",height:"2.363ex",role:"img",focusable:"false",viewBox:"0 -750 7151.6 1044.2","aria-hidden":"true"},Y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},F={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"2.117ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 935.7 840.8","aria-hidden":"true"},W={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},$={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.735ex"},xmlns:"http://www.w3.org/2000/svg",width:"17.141ex",height:"3.135ex",role:"img",focusable:"false",viewBox:"0 -1060.7 7576.5 1385.6","aria-hidden":"true"},U={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},t1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.959ex",height:"1.414ex",role:"img",focusable:"false",viewBox:"0 -431 2191.8 625","aria-hidden":"true"},Q1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},e1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.009ex",height:"1.545ex",role:"img",focusable:"false",viewBox:"0 -683 888 683","aria-hidden":"true"},a1={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},T1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.05ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.74ex",height:"1.595ex",role:"img",focusable:"false",viewBox:"0 -683 769 705","aria-hidden":"true"},l1={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},o1={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.858ex"},xmlns:"http://www.w3.org/2000/svg",width:"21.929ex",height:"5.933ex",role:"img",focusable:"false",viewBox:"0 -1359 9692.5 2622.3","aria-hidden":"true"};function s1(n1,Q,r1,i1,d1,m1){return T(),e("div",null,[Q[68]||(Q[68]=l("",58)),t("mjx-container",u,[(T(),e("svg",x,[...Q[0]||(Q[0]=[l("",1)])])),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mi",null,"P"),t("mo",null,"="),t("msup",null,[t("mi",null,"H"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msub",null,[t("mi",null,"τ"),t("mn",null,"1")])])]),t("mo",null,"⋅"),t("msup",null,[t("mi",null,"V"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msub",null,[t("mi",null,"τ"),t("mn",null,"2")])])])])],-1))]),Q[69]||(Q[69]=t("p",null,"P：偏好评分，表示该层“想要”分配到多少缓存空间",-1)),Q[70]||(Q[70]=t("p",null,"H：该层注意力的空间离散度，通过注意力行向量的熵值（Entropy）计算，衡量每个 token 的关注是否分散",-1)),Q[71]||(Q[71]=t("p",null,"V：该层注意力的时间变化度（Shift），通过注意力列向量的方差（Variance）计算，衡量对某 token 的关注是否在时间上波动剧烈",-1)),Q[72]||(Q[72]=t("p",null,"直觉解释：",-1)),Q[73]||(Q[73]=t("p",null,"如果一个层的注意力很分散（高熵），它在一个时刻可能需要引用很多位置的 KV",-1)),Q[74]||(Q[74]=t("p",null,"如果一个层的注意力波动性高（高方差），说明它在不同时间步使用的 KV 不稳定，也值得保留更多 KV Cache 以应对动态变化",-1)),Q[75]||(Q[75]=t("p",null,"CAKE 实际流程:",-1)),Q[76]||(Q[76]=t("p",null,"Step1: 收集注意力矩阵",-1)),t("p",null,[Q[6]||(Q[6]=a("对于某一层 ",-1)),t("mjx-container",w,[(T(),e("svg",c,[...Q[2]||(Q[2]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D459",d:"M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[3]||(Q[3]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"l")])],-1))]),Q[7]||(Q[7]=a("，我们获取最近一段上下文（如最近 512 个 token）上的注意力矩阵 ",-1)),t("mjx-container",H,[(T(),e("svg",k,[...Q[4]||(Q[4]=[l("",1)])])),Q[5]||(Q[5]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"A"),t("mi",null,"l")]),t("mo",null,"∈"),t("msup",null,[t("mi",null,"R"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"T"),t("mo",null,"×"),t("mi",null,"T")])])])],-1))]),Q[8]||(Q[8]=a(" （同 SnapKV 的策略）。",-1))]),t("p",null,[Q[15]||(Q[15]=a("其中 ",-1)),t("mjx-container",f,[(T(),e("svg",L,[...Q[9]||(Q[9]=[l("",1)])])),Q[10]||(Q[10]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mi",null,"i"),t("mo",null,","),t("mi",null,"j"),t("mo",{stretchy:"false"},"]")])],-1))]),Q[16]||(Q[16]=a(" 表示第 ",-1)),t("mjx-container",V,[(T(),e("svg",y,[...Q[11]||(Q[11]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[12]||(Q[12]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"i")])],-1))]),Q[17]||(Q[17]=a(" 个 token 对第 ",-1)),t("mjx-container",M,[(T(),e("svg",b,[...Q[13]||(Q[13]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D457",d:"M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[14]||(Q[14]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"j")])],-1))]),Q[18]||(Q[18]=a(" 个 token 的注意力权重。",-1))]),Q[77]||(Q[77]=t("p",null,"对多头注意力，通常对各个 head 的矩阵取平均或最大池化。",-1)),t("p",null,[Q[21]||(Q[21]=a("Step2: 计算空间离散度",-1)),t("mjx-container",v,[(T(),e("svg",Z,[...Q[19]||(Q[19]=[l("",1)])])),Q[20]||(Q[20]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"H"),t("mi",null,"l")])])],-1))]),Q[22]||(Q[22]=a("：衡量注意力是否分散",-1))]),t("ol",null,[t("li",null,[Q[27]||(Q[27]=a("对于每一行",-1)),t("mjx-container",_,[(T(),e("svg",D,[...Q[23]||(Q[23]=[l("",1)])])),Q[24]||(Q[24]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mi",null,"i"),t("mo",null,","),t("mo",null,":"),t("mo",{stretchy:"false"},"]")])],-1))]),Q[28]||(Q[28]=a("，表示第",-1)),t("mjx-container",C,[(T(),e("svg",S,[...Q[25]||(Q[25]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[26]||(Q[26]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"i")])],-1))]),Q[29]||(Q[29]=a("个 token 在当前层关注上下文中各位置的权重分布。",-1))]),Q[30]||(Q[30]=t("li",null,"对每一行计算熵（entropy）：",-1))]),t("mjx-container",j,[(T(),e("svg",A,[...Q[31]||(Q[31]=[l("",1)])])),Q[32]||(Q[32]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("msub",null,[t("mi",null,"H"),t("mi",null,"i")]),t("mo",null,"="),t("mo",null,"−"),t("munder",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mi",null,"j")]),t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mi",null,"i"),t("mo",null,","),t("mi",null,"j"),t("mo",{stretchy:"false"},"]"),t("mo",null,"⋅"),t("mi",null,"log"),t("mo",{"data-mjx-texclass":"NONE"},"⁡"),t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mi",null,"i"),t("mo",null,","),t("mi",null,"j"),t("mo",{stretchy:"false"},"]")])],-1))]),t("ol",P,[t("li",null,[Q[35]||(Q[35]=a("将所有行的熵取平均，得出该层的空间离散度",-1)),t("mjx-container",K,[(T(),e("svg",B,[...Q[33]||(Q[33]=[l("",1)])])),Q[34]||(Q[34]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"H"),t("mi",null,"l")])])],-1))])])]),t("mjx-container",R,[(T(),e("svg",I,[...Q[36]||(Q[36]=[l("",1)])])),Q[37]||(Q[37]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("msub",null,[t("mi",null,"H"),t("mi",null,"l")]),t("mo",null,"="),t("mfrac",null,[t("mn",null,"1"),t("mi",null,"T")]),t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"i"),t("mo",null,"="),t("mn",null,"1")]),t("mi",null,"T")]),t("msub",null,[t("mi",null,"H"),t("mi",null,"i")])])],-1))]),Q[78]||(Q[78]=t("p",null,"熵越高，表示注意力越＂铺得广＂，该层更依赖历史上下文。",-1)),t("p",null,[Q[40]||(Q[40]=a("Step3: 计算时间变化度",-1)),t("mjx-container",E,[(T(),e("svg",O,[...Q[38]||(Q[38]=[l("",1)])])),Q[39]||(Q[39]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"V"),t("mi",null,"l")])])],-1))]),Q[41]||(Q[41]=a("：衡量注意力是否波动",-1))]),t("p",null,[Q[46]||(Q[46]=a("对于每一列 ",-1)),t("mjx-container",N,[(T(),e("svg",X,[...Q[42]||(Q[42]=[l("",1)])])),Q[43]||(Q[43]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mo",null,":"),t("mo",null,","),t("mi",null,"j"),t("mo",{stretchy:"false"},"]")])],-1))]),Q[47]||(Q[47]=a(" ，表示其他 token 对第 ",-1)),t("mjx-container",J,[(T(),e("svg",q,[...Q[44]||(Q[44]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D457",d:"M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[45]||(Q[45]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"j")])],-1))]),Q[48]||(Q[48]=a(" 个 token 的关注程度。",-1))]),Q[79]||(Q[79]=t("p",null,"对列向量计算时间上的方差：",-1)),t("mjx-container",G,[(T(),e("svg",z,[...Q[49]||(Q[49]=[l("",1)])])),Q[50]||(Q[50]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("msub",null,[t("mi",null,"V"),t("mi",null,"j")]),t("mo",null,"="),t("mi",null,"Var"),t("mo",{stretchy:"false"},"("),t("mi",null,"A"),t("mo",{stretchy:"false"},"["),t("mo",null,":"),t("mo",null,","),t("mi",null,"j"),t("mo",{stretchy:"false"},"]"),t("mo",{stretchy:"false"},")")])],-1))]),t("p",null,[Q[53]||(Q[53]=a("Step4: 计算偏好评分",-1)),t("mjx-container",Y,[(T(),e("svg",F,[...Q[51]||(Q[51]=[l("",1)])])),Q[52]||(Q[52]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"P"),t("mi",null,"l")])])],-1))]),Q[54]||(Q[54]=a("：组合两个因素",-1))]),t("mjx-container",W,[(T(),e("svg",$,[...Q[55]||(Q[55]=[l("",1)])])),Q[56]||(Q[56]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("msub",null,[t("mi",null,"P"),t("mi",null,"l")]),t("mo",null,"="),t("msubsup",null,[t("mi",null,"H"),t("mi",null,"l"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msub",null,[t("mi",null,"τ"),t("mn",null,"1")])])]),t("mo",null,"⋅"),t("msubsup",null,[t("mi",null,"V"),t("mi",null,"l"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mn",null,"1"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mo",null,"/")]),t("msub",null,[t("mi",null,"τ"),t("mn",null,"2")])])])])],-1))]),t("p",null,[t("mjx-container",U,[(T(),e("svg",t1,[...Q[57]||(Q[57]=[l("",1)])])),Q[58]||(Q[58]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"τ"),t("mn",null,"1")]),t("mo",null,","),t("msub",null,[t("mi",null,"τ"),t("mn",null,"2")])])],-1))]),Q[63]||(Q[63]=a(" 是两个可调温度系数，控制",-1)),t("mjx-container",Q1,[(T(),e("svg",e1,[...Q[59]||(Q[59]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D43B",d:"M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[60]||(Q[60]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"H")])],-1))]),Q[64]||(Q[64]=a("和",-1)),t("mjx-container",a1,[(T(),e("svg",T1,[...Q[61]||(Q[61]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D449",d:"M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[62]||(Q[62]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"V")])],-1))]),Q[65]||(Q[65]=a("的权重。",-1))]),Q[80]||(Q[80]=t("p",null,"Step5: 分配缓存预算（Cache Budget Allocation）",-1)),Q[81]||(Q[81]=t("p",null,"将每一层的偏好评分归一化：",-1)),t("mjx-container",l1,[(T(),e("svg",o1,[...Q[66]||(Q[66]=[l("",1)])])),Q[67]||(Q[67]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("msub",null,[t("mi",null,"B"),t("mi",null,"l")]),t("mo",null,"="),t("mfrac",null,[t("msub",null,[t("mi",null,"P"),t("mi",null,"l")]),t("mrow",null,[t("munderover",null,[t("mo",{"data-mjx-texclass":"OP"},"∑"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",null,"k"),t("mo",null,"="),t("mn",null,"1")]),t("mi",null,"L")]),t("msub",null,[t("mi",null,"P"),t("mi",null,"k")])])]),t("mo",null,"⋅"),t("msub",null,[t("mi",null,"B"),t("mrow",{"data-mjx-texclass":"ORD"},[t("mtext",null,"total ")])])])],-1))]),Q[82]||(Q[82]=l("",13))])}const g1=o(g,[["render",s1]]);export{h1 as __pageData,g1 as default};
