import{_ as l,c as a,q as s,a as t,N as T,o as e}from"./chunks/framework.BRsttz9t.js";const o="/assets/massive_activation_1.CJ4zdMhx.png",r="/assets/massive_activation_2.CWH_QTTX.png",n="/assets/channel_wise_outlier.BGISsP-d.png",i="/assets/outlier_location.BTfU0nL0.png",d="/assets/weight_outlier.xT-yTRNT.png",m="/assets/weight_outlier_coordinate.C8XVGv08.png",p="/assets/prob_shift.BFfP0EKa.png",h="/assets/outlier_scaling.BaQUN1GQ.png",z=JSON.parse('{"title":"【论文分享】| LLM 中变量离群性的探索","description":"","frontmatter":{"title":"【论文分享】| LLM 中变量离群性的探索","date":"2025-07-15T00:00:00.000Z","author":{"name":"孙研","github":"woodenchild95"},"category":"insights"},"headers":[],"relativePath":"posts/outlier-in-llm-paper-sharing.md","filePath":"posts/outlier-in-llm-paper-sharing.md"}'),g={name:"posts/outlier-in-llm-paper-sharing.md"},H={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},u={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.308ex"},xmlns:"http://www.w3.org/2000/svg",width:"57.395ex",height:"5.804ex",role:"img",focusable:"false",viewBox:"0 -1545.3 25368.4 2565.3","aria-hidden":"true"},x={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},c={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.577ex"},xmlns:"http://www.w3.org/2000/svg",width:"30.631ex",height:"4.425ex",role:"img",focusable:"false",viewBox:"0 -1259 13538.9 1956","aria-hidden":"true"},w={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},V={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.934ex",height:"2.42ex",role:"img",focusable:"false",viewBox:"0 -853.7 3948.9 1069.7","aria-hidden":"true"},f={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},L={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.515ex",height:"2.084ex",role:"img",focusable:"false",viewBox:"0 -705 1553.7 921","aria-hidden":"true"},k={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.464ex"},xmlns:"http://www.w3.org/2000/svg",width:"6.958ex",height:"1.783ex",role:"img",focusable:"false",viewBox:"0 -583 3075.6 788","aria-hidden":"true"},y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},v={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.355ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.17ex",height:"1.901ex",role:"img",focusable:"false",viewBox:"0 -683 1401.1 840.1","aria-hidden":"true"},b={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},_={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"3.01ex",height:"1.902ex",role:"img",focusable:"false",viewBox:"0 -683 1330.3 840.8","aria-hidden":"true"},Z={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.229ex",height:"1.486ex",role:"img",focusable:"false",viewBox:"0 -441 543 657","aria-hidden":"true"},A={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},D={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.229ex",height:"1.486ex",role:"img",focusable:"false",viewBox:"0 -441 543 657","aria-hidden":"true"},S={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},j={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.229ex",height:"1.486ex",role:"img",focusable:"false",viewBox:"0 -441 543 657","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},E={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.489ex"},xmlns:"http://www.w3.org/2000/svg",width:"1.229ex",height:"1.486ex",role:"img",focusable:"false",viewBox:"0 -441 543 657","aria-hidden":"true"};function q(I,Q,N,B,G,F){return e(),a("div",null,[Q[36]||(Q[36]=s("",14)),t("mjx-container",H,[(e(),a("svg",u,[...Q[0]||(Q[0]=[s("",1)])])),Q[1]||(Q[1]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mtext",null,"Attention"),t("mo",{stretchy:"false"},"("),t("mi",null,"Q"),t("mo",null,","),t("mi",null,"K"),t("mo",null,","),t("mi",null,"V"),t("mo",null,";"),t("msup",null,[t("mi",null,"k"),t("mo",{"data-mjx-alternate":"1"},"′")]),t("mo",null,","),t("msup",null,[t("mi",null,"v"),t("mo",{"data-mjx-alternate":"1"},"′")]),t("mo",{stretchy:"false"},")"),t("mo",null,"="),t("mtext",null,"softmax"),t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"("),t("mfrac",null,[t("mrow",null,[t("mi",null,"Q"),t("mo",{stretchy:"false"},"["),t("msup",null,[t("mi",null,"K"),t("mi",{mathvariant:"normal"},"⊤")]),t("msup",null,[t("mi",null,"k"),t("mo",{"data-mjx-alternate":"1"},"′")]),t("mo",{stretchy:"false"},"]")]),t("msqrt",null,[t("mi",null,"d")])]),t("mo",{"data-mjx-texclass":"CLOSE"},")")]),t("msup",null,[t("mrow",{"data-mjx-texclass":"INNER"},[t("mo",{"data-mjx-texclass":"OPEN"},"["),t("msup",null,[t("mi",null,"V"),t("mi",{mathvariant:"normal"},"⊤")]),t("msup",null,[t("mi",null,"v"),t("mo",{"data-mjx-alternate":"1"},"′")]),t("mo",{"data-mjx-texclass":"CLOSE"},"]")]),t("mi",{mathvariant:"normal"},"⊤")]),t("mo",null,".")])],-1))]),Q[37]||(Q[37]=t("p",null,"对于原始的 attention 公式在最后加一个可学习的维度来捕捉 bias，这可以缓解 Attention 中的 massive activation 问题。",-1)),Q[38]||(Q[38]=t("p",null,"[1] 可以拓展的方向: 这个实验有趣的点在于，它最终成功将 softmax 输出的更大的关注度转移到 v'向量上，换句话说，k'在训练过程中，会主动保持与需要被关注的 token 的同向性，它的结果是其他 token 在互相关注时，不再需要保持概率为 1，而是小于等于 1，它提供了更多的 token 的聚合能力。",-1)),Q[39]||(Q[39]=t("h3",{id:"_2-2-通道离群值-channel-wise-outlier",tabindex:"-1"},[T("2.2 通道离群值（Channel-wise Outlier） "),t("a",{class:"header-anchor",href:"#_2-2-通道离群值-channel-wise-outlier","aria-label":'Permalink to "2.2 通道离群值（Channel-wise Outlier）"'},"​")],-1)),Q[40]||(Q[40]=t("p",null,"[2] 进一步探索了通道离群性，是前向过程中稳定出现的特定 channel（维度）出现的离群性，一般表示为每个 token 中某些固定维度经常性出现较大的值，如下图（右）所示：",-1)),Q[41]||(Q[41]=t("p",null,[t("img",{src:n,alt:"picture 2"})],-1)),Q[42]||(Q[42]=t("p",null,"通道离群通常出现在归一化层后，并且隐形伴随在整个网络的激活值分布中。目前对这一分布形成的原因，大致认为是归一化过程中的超参数引起的相变。例如，对于层归一化（RMSNorm 同理），",-1)),t("mjx-container",x,[(e(),a("svg",c,[...Q[2]||(Q[2]=[s("",1)])])),Q[3]||(Q[3]=t("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[t("mtext",null,"LayerNorm"),t("mo",{stretchy:"false"},"("),t("mi",null,"x"),t("mo",{stretchy:"false"},")"),t("mo",null,"="),t("mi",null,"γ"),t("mo",null,"⋅"),t("mfrac",null,[t("mrow",null,[t("mi",null,"x"),t("mo",null,"−"),t("mi",null,"μ")]),t("mi",null,"σ")]),t("mo",null,"+"),t("mi",null,"β")])],-1))]),t("p",null,[Q[8]||(Q[8]=T("其中",-1)),t("mjx-container",w,[(e(),a("svg",V,[...Q[4]||(Q[4]=[s("",1)])])),Q[5]||(Q[5]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ"),t("mo",null,","),t("mi",null,"β"),t("mo",null,"∈"),t("msup",null,[t("mrow",{"data-mjx-texclass":"ORD"},[t("mi",{mathvariant:"double-struck"},"R")]),t("mi",null,"d")])])],-1))]),Q[9]||(Q[9]=T(" 属于 token embedding 维度的归一化，对于",-1)),t("mjx-container",f,[(e(),a("svg",L,[...Q[6]||(Q[6]=[s("",1)])])),Q[7]||(Q[7]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ"),t("mo",null,","),t("mi",null,"β")])],-1))]),Q[10]||(Q[10]=T("的某些维度出现了很大的值，从而引起归一化过程中某个维度的绝对值一直很大，从而造成了普遍的通道离群性。",-1))]),Q[43]||(Q[43]=t("p",null,"除此之外，[2] 给出了一个新的探索结论，即 Massive Activation 首次出现在第一层 FFN 的激活层后（LLaMA/Qwen 的 y6 以及 GPT 的 y4）",-1)),Q[44]||(Q[44]=t("p",null,[t("img",{src:i,alt:"picture 3"})],-1)),t("p",null,[Q[17]||(Q[17]=T("所以 ",-1)),t("mjx-container",k,[(e(),a("svg",M,[...Q[11]||(Q[11]=[s("",1)])])),Q[12]||(Q[12]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"y"),t("mn",null,"4")]),t("mo",null,"⊙"),t("msub",null,[t("mi",null,"y"),t("mn",null,"5")])])],-1))]),Q[18]||(Q[18]=T(" 中出现了巨幅激活，即 ",-1)),t("mjx-container",y,[(e(),a("svg",v,[...Q[13]||(Q[13]=[s("",1)])])),Q[14]||(Q[14]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"W"),t("mi",null,"a")])])],-1))]),Q[19]||(Q[19]=T("或 ",-1)),t("mjx-container",b,[(e(),a("svg",_,[...Q[15]||(Q[15]=[s("",1)])])),Q[16]||(Q[16]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("msub",null,[t("mi",null,"W"),t("mi",null,"b")])])],-1))]),Q[20]||(Q[20]=T(" 中出现了超级权重。",-1))]),Q[45]||(Q[45]=t("p",null,"根据这个结论，一系列新的实验围绕着如何平滑巨幅激活值进行探索，主要都是行为性测试，总结如下：",-1)),Q[46]||(Q[46]=t("p",null,"（1）输出位置的巨幅激活值是不能平滑的。",-1)),Q[47]||(Q[47]=t("p",null,"（2）skip connection 传下来的巨幅激活值时可以平滑的。",-1)),t("p",null,[Q[25]||(Q[25]=T("[2] 的观测猜想与解决思路: 对归一化层训练的",-1)),t("mjx-container",Z,[(e(),a("svg",C,[...Q[21]||(Q[21]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FE",d:"M31 249Q11 249 11 258Q11 275 26 304T66 365T129 418T206 441Q233 441 239 440Q287 429 318 386T371 255Q385 195 385 170Q385 166 386 166L398 193Q418 244 443 300T486 391T508 430Q510 431 524 431H537Q543 425 543 422Q543 418 522 378T463 251T391 71Q385 55 378 6T357 -100Q341 -165 330 -190T303 -216Q286 -216 286 -188Q286 -138 340 32L346 51L347 69Q348 79 348 100Q348 257 291 317Q251 355 196 355Q148 355 108 329T51 260Q49 251 47 251Q45 249 31 249Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[22]||(Q[22]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ")])],-1))]),Q[26]||(Q[26]=T("中对应通道的离群值直接赋值为 1 或均值，标准化过程并不产生离群性，核心是",-1)),t("mjx-container",A,[(e(),a("svg",D,[...Q[23]||(Q[23]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FE",d:"M31 249Q11 249 11 258Q11 275 26 304T66 365T129 418T206 441Q233 441 239 440Q287 429 318 386T371 255Q385 195 385 170Q385 166 386 166L398 193Q418 244 443 300T486 391T508 430Q510 431 524 431H537Q543 425 543 422Q543 418 522 378T463 251T391 71Q385 55 378 6T357 -100Q341 -165 330 -190T303 -216Q286 -216 286 -188Q286 -138 340 32L346 51L347 69Q348 79 348 100Q348 257 291 317Q251 355 196 355Q148 355 108 329T51 260Q49 251 47 251Q45 249 31 249Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[24]||(Q[24]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ")])],-1))]),Q[27]||(Q[27]=T("的离群性引起的通道巨值。",-1))]),t("p",null,[Q[30]||(Q[30]=T("[2] 的可以拓展的方向： ",-1)),t("mjx-container",S,[(e(),a("svg",j,[...Q[28]||(Q[28]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FE",d:"M31 249Q11 249 11 258Q11 275 26 304T66 365T129 418T206 441Q233 441 239 440Q287 429 318 386T371 255Q385 195 385 170Q385 166 386 166L398 193Q418 244 443 300T486 391T508 430Q510 431 524 431H537Q543 425 543 422Q543 418 522 378T463 251T391 71Q385 55 378 6T357 -100Q341 -165 330 -190T303 -216Q286 -216 286 -188Q286 -138 340 32L346 51L347 69Q348 79 348 100Q348 257 291 317Q251 355 196 355Q148 355 108 329T51 260Q49 251 47 251Q45 249 31 249Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[29]||(Q[29]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ")])],-1))]),Q[31]||(Q[31]=T("的本质是可学习的参数，因此可以直接对归一化的参数进行额外的正则监督（l1 正则或者其他度量形式）",-1))]),Q[48]||(Q[48]=s("",14)),t("p",null,[Q[34]||(Q[34]=T("归一化的问题需要被归类为参数中的问题，因为归一化函数可能不是产生巨幅激活值的根本原因，而是由于训练过程中，这个通道持续性的巨幅激活值导致",-1)),t("mjx-container",P,[(e(),a("svg",E,[...Q[32]||(Q[32]=[t("g",{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"scale(1,-1)"},[t("g",{"data-mml-node":"math"},[t("g",{"data-mml-node":"mi"},[t("path",{"data-c":"1D6FE",d:"M31 249Q11 249 11 258Q11 275 26 304T66 365T129 418T206 441Q233 441 239 440Q287 429 318 386T371 255Q385 195 385 170Q385 166 386 166L398 193Q418 244 443 300T486 391T508 430Q510 431 524 431H537Q543 425 543 422Q543 418 522 378T463 251T391 71Q385 55 378 6T357 -100Q341 -165 330 -190T303 -216Q286 -216 286 -188Q286 -138 340 32L346 51L347 69Q348 79 348 100Q348 257 291 317Q251 355 196 355Q148 355 108 329T51 260Q49 251 47 251Q45 249 31 249Z",style:{"stroke-width":"3"}})])])],-1)])])),Q[33]||(Q[33]=t("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[t("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[t("mi",null,"γ")])],-1))]),Q[35]||(Q[35]=T("追踪到这些巨值上去，不应该被直接归类为强因果关系。",-1))]),Q[49]||(Q[49]=s("",12))])}const O=l(g,[["render",q]]);export{z as __pageData,O as default};
