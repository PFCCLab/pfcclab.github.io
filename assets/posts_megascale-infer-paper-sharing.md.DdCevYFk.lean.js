import{_ as s,c as a,q as T,a as Q,N as l,o as e}from"./chunks/framework.BRsttz9t.js";const m="/assets/background.DuM0176Y.jpg",o="/assets/utilization.Ll9Razpo.jpg",n="/assets/architecture.3844cLX9.jpg",r="/assets/hardware.CceElghp.jpg",d="/assets/pipeline.85Wbk7ng.jpg",i="/assets/searching.-TS8AhC8.jpg",h="/assets/benchmark.CZamj0Jc.jpg",p="/assets/sender_receiver.A-wdjmXC.jpg",g="/assets/throughput.FmMTmsh0.jpg",H="/assets/latency-data.m6TDDrYc.jpg",c="/assets/latency-num.BcRZ5IKu.jpg",z=JSON.parse('{"title":"【论文分享】｜MegaScale-Infer：分离注意力层和专家层来提高专家层的计算利用率","description":"","frontmatter":{"title":"【论文分享】｜MegaScale-Infer：分离注意力层和专家层来提高专家层的计算利用率","date":"2025-06-13T00:00:00.000Z","author":{"name":"陈煜彦","github":"cyy536"},"category":"insights"},"headers":[],"relativePath":"posts/megascale-infer-paper-sharing.md","filePath":"posts/megascale-infer-paper-sharing.md"}'),u={name:"posts/megascale-infer-paper-sharing.md"},L={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},w={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.357ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.627ex",height:"1.889ex",role:"img",focusable:"false",viewBox:"0 -677 3371.1 834.8","aria-hidden":"true"},x={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},f={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"7.608ex",height:"2.199ex",role:"img",focusable:"false",viewBox:"0 -677 3362.6 972","aria-hidden":"true"},V={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},M={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"17.495ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 7732.7 1045","aria-hidden":"true"},y={class:"MathJax",jax:"SVG",style:{direction:"ltr",position:"relative"}},k={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"23.172ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 10241.9 1045","aria-hidden":"true"},b={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},Z={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"46.066ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 20361.2 1045","aria-hidden":"true"},_={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},D={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.667ex"},xmlns:"http://www.w3.org/2000/svg",width:"37.389ex",height:"2.364ex",role:"img",focusable:"false",viewBox:"0 -750 16525.8 1045","aria-hidden":"true"},v={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},C={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"11.992ex",height:"2.034ex",role:"img",focusable:"false",viewBox:"0 -705 5300.3 899","aria-hidden":"true"},j={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},A={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-2.016ex"},xmlns:"http://www.w3.org/2000/svg",width:"25.36ex",height:"5.115ex",role:"img",focusable:"false",viewBox:"0 -1370 11208.9 2261","aria-hidden":"true"},P={class:"MathJax",jax:"SVG",display:"true",style:{direction:"ltr",display:"block","text-align":"center",margin:"1em 0",position:"relative"}},S={style:{overflow:"visible","min-height":"1px","min-width":"1px","vertical-align":"-1.991ex"},xmlns:"http://www.w3.org/2000/svg",width:"26.626ex",height:"5.294ex",role:"img",focusable:"false",viewBox:"0 -1460 11768.6 2340","aria-hidden":"true"};function N(R,t,E,F,O,I){return e(),a("div",null,[t[26]||(t[26]=T("",26)),Q("ol",null,[Q("li",null,[Q("mjx-container",L,[(e(),a("svg",w,[...t[0]||(t[0]=[T("",1)])])),t[1]||(t[1]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"≈"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")])])],-1))]),t[2]||(t[2]=Q("ul",null,[Q("li",null,"计算时间平衡，减少空闲")],-1))]),Q("li",null,[Q("mjx-container",x,[(e(),a("svg",f,[...t[3]||(t[3]=[T("",1)])])),t[4]||(t[4]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")])])],-1))]),t[7]||(t[7]=l("，其中 ",-1)),Q("mjx-container",V,[(e(),a("svg",M,[...t[5]||(t[5]=[T("",1)])])),t[6]||(t[6]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"="),Q("mo",{"data-mjx-texclass":"OP",movablelimits:"true"},"max"),Q("mo",{fence:"false",stretchy:"false"},"{"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,","),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",{fence:"false",stretchy:"false"},"}")])],-1))]),t[8]||(t[8]=l("。 ",-1)),t[9]||(t[9]=Q("ul",null,[Q("li",null,"计算时间大于通信时间")],-1))]),Q("li",null,[Q("mjx-container",y,[(e(),a("svg",k,[...t[10]||(t[10]=[T("",1)])])),t[11]||(t[11]=Q("mjx-assistive-mml",{unselectable:"on",display:"inline",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",width:"auto",overflow:"hidden"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[Q("mi",null,"m"),Q("mo",null,"×"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"≥"),Q("mn",null,"2"),Q("mo",null,"×"),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")")])],-1))]),t[19]||(t[19]=l("。 ",-1)),Q("ul",null,[Q("li",null,[t[18]||(t[18]=l("global-batch 经过 Attention/FFN 层的时间要大于 micro batch 经过两者的时间之和，否则有空闲，要求 micro-batch 数量足够多 ",-1)),Q("ul",null,[Q("li",null,[t[14]||(t[14]=l("micro-batch 时延：",-1)),Q("mjx-container",b,[(e(),a("svg",Z,[...t[12]||(t[12]=[T("",1)])])),t[13]||(t[13]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"+"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"L"),Q("mo",null,"−"),Q("mn",null,"1"),Q("mo",{stretchy:"false"},")"),Q("mo",null,"≤"),Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"iter")])]),Q("mo",null,"≤"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mi",null,"L"),Q("mo",null,".")])],-1))])]),Q("li",null,[t[17]||(t[17]=l("global-batch 时延：",-1)),Q("mjx-container",_,[(e(),a("svg",D,[...t[15]||(t[15]=[T("",1)])])),t[16]||(t[16]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"total")])]),Q("mo",null,"="),Q("mo",{stretchy:"false"},"("),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"a")]),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"e")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"c")]),Q("mo",{stretchy:"false"},")"),Q("mo",null,"+"),Q("msub",null,[Q("mi",null,"T"),Q("mi",null,"f")]),Q("mo",{stretchy:"false"},"("),Q("mi",null,"m"),Q("mi",null,"L"),Q("mo",null,"−"),Q("mn",null,"1"),Q("mo",{stretchy:"false"},")")])],-1))])])])])])])]),t[27]||(t[27]=Q("p",null,[l("设计流水线需要确定一些超参，设计了一个"),Q("strong",null,"超参数搜索"),l("的算法，其搜索空间包括 Attention Node 和 Expert Node 的张量并行度大小，micro-batch 数量（m），单位成本的吞吐量作为优化目标。")],-1)),t[28]||(t[28]=Q("p",null,[Q("img",{src:i,alt:"alt text"})],-1)),t[29]||(t[29]=Q("p",null,"时延要求和 KV 显存限制：",-1)),Q("mjx-container",v,[(e(),a("svg",C,[...t[20]||(t[20]=[T("",1)])])),t[21]||(t[21]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"iter")])]),Q("mo",null,"≤"),Q("mtext",null,"SLO"),Q("mo",null,",")])],-1))]),Q("mjx-container",j,[(e(),a("svg",A,[...t[22]||(t[22]=[T("",1)])])),t[23]||(t[23]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mfrac",null,[Q("mrow",null,[Q("mn",null,"4"),Q("mi",null,"m"),Q("msub",null,[Q("mi",null,"b"),Q("mi",null,"a")]),Q("mi",null,"s"),Q("mi",null,"h"),Q("mi",null,"L")]),Q("mi",null,"g")]),Q("mo",null,"+"),Q("mn",null,"2"),Q("msub",null,[Q("mi",null,"P"),Q("mi",null,"a")]),Q("mo",null,"<"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"p"),Q("mi",null,"a")])]),Q("msub",null,[Q("mi",null,"C"),Q("mi",null,"a")]),Q("mo",null,".")])],-1))]),t[30]||(t[30]=Q("p",null,"目标：",-1)),Q("mjx-container",P,[(e(),a("svg",S,[...t[24]||(t[24]=[T("",1)])])),t[25]||(t[25]=Q("mjx-assistive-mml",{unselectable:"on",display:"block",style:{top:"0px",left:"0px",clip:"rect(1px, 1px, 1px, 1px)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",position:"absolute",padding:"1px 0px 0px 0px",border:"0px",display:"block",overflow:"hidden",width:"100%"}},[Q("math",{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},[Q("mfrac",null,[Q("mrow",null,[Q("mi",null,"B"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mo",null,"/")]),Q("msub",null,[Q("mi",null,"T"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mtext",null,"total")])])]),Q("mrow",null,[Q("mi",null,"t"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("msub",null,[Q("mi",null,"n"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"C"),Q("mi",null,"o"),Q("mi",null,"s"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"a")])]),Q("mo",null,"+"),Q("mi",null,"t"),Q("msub",null,[Q("mi",null,"p"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"e")])]),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"E"),Q("mstyle",{scriptlevel:"0"},[Q("mspace",{width:"0.167em"})]),Q("mi",null,"C"),Q("mi",null,"o"),Q("mi",null,"s"),Q("msub",null,[Q("mi",null,"t"),Q("mrow",{"data-mjx-texclass":"ORD"},[Q("mi",null,"e")])])])])])],-1))]),t[31]||(t[31]=T("",22))])}const G=s(u,[["render",N]]);export{z as __pageData,G as default};
